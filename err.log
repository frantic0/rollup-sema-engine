(!) Use of eval is strongly discouraged
https://rollupjs.org/guide/en/#avoiding-eval
node_modules/sema-engine/sema-engine.mjs
1: class RingBuffer{static getStorageForCapacity(e,t){if(!t.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var o=8+(e+1)*t.BYTES_PER_ELEMENT;return new SharedArrayBuffer(o)}constructor(e,t){if(!ArrayBuffer.__proto__.isPrototypeOf(t)&&void 0!==t.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=t,this.capacity=(e.byteLength-8)/t.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new t(this.buf,8,this.capacity)}type(){return this._type.name}push(e){var t=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);if((o+1)%this._storage_capacity()==t)return 0;let i=Math.min(this._available_write(t,o),e.length),l=Math.min(this._storage_capacity()-o,i),s=i-l;return this._copy(e,0,this.storage,o,l),this._copy(e,l,this.storage,0,s),Atomics.store(this.write_ptr,0,(o+i)%this._storage_capacity()),i}pop(e){var t=Atomics.load(this.read_ptr,0),o=Atomics.load(this.write_ptr,0);if(o==t)return 0;let i=Math.min(this._available_read(t,o),e.length),l=Math.min(this._storage_capacity()-t,e.length),s=i-l;return this._copy(this.storage,t,e,0,l),this._copy(this.storage,0,e,l,s),Atomics.store(this.read_ptr,0,(t+i)%this._storage_capacity()),i}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=e}capacity(){return this.capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}_available_read(e,t){return t>e?t-e:t+this._storage_capacity()-e}_available_write(e,t){let o=e-t-1;return t>=e&&(o+=this._storage_capacity()),o}_storage_capacity(){return this.capacity}_copy(e,t,o,i,l){for(var s=0;s<l;s++)o[i+s]=e[t+s]}}const getBase64=e=>{if(-1!==e.indexOf(";base64,")){var t=e.indexOf(";base64,")+8;return!!e.slice(t).match(/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/)&&e.slice(t)}return!1},_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",removePaddingFromBase64=e=>64===Module.maxiTools._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e,loadSampleToArray=(e,t,o,i)=>{var l=[],s=getBase64(o);if(s){var n=s.length/4*3,r=new ArrayBuffer(n);s=removePaddingFromBase64(removePaddingFromBase64(s));var g,a,I,c,C,p,u,d=parseInt(s.length/4*3,10),m=0,A=0;for(g=new Uint8Array(r),s=s.replace(/[^A-Za-z0-9\+\/\=]/g,""),m=0;m<d;m+=3)a=_keyStr.indexOf(s.charAt(A++))<<2|(C=_keyStr.indexOf(s.charAt(A++)))>>4,I=(15&C)<<4|(p=_keyStr.indexOf(s.charAt(A++)))>>2,c=(3&p)<<6|(u=_keyStr.indexOf(s.charAt(A++))),g[m]=a,64!==p&&(g[m+1]=I),64!==u&&(g[m+2]=c);e.decodeAudioData(r,(function(e){let o=e.getChannelData(0);void 0!==l&&void 0!==i&&i.port.postMessage({sample:t,buffer:o})}),(function(e){console.log("Error decoding source!")}))}else{var h=new XMLHttpRequest;h.addEventListener("load",(()=>console.log("The transfer is complete."))),h.open("GET",o,!0),h.responseType="arraybuffer",h.onload=function(){e.decodeAudioData(h.response,(function(e){let o=e.getChannelData(0);void 0!==l&&void 0!==i&&i.port.postMessage({sample:t,buffer:o})}),(function(e){console.log("Error decoding source!")}))},h.send()}return"Loading module"};class Event{constructor(e){this.eventName=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}unregisterCallback(e){const t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)}emit(e){this.callbacks.slice(0).forEach((t=>{t(e)}))}}class Dispatcher{constructor(){this.events={}}dispatch(e,t){const o=this.events[e];o&&o.emit(t)}addEventListener(e,t){let o=this.events[e];o||(o=new Event(e),this.events[e]=o),o.registerCallback(t)}removeEventListener(e,t){const o=this.events[e];o&&o.callbacks.indexOf(t)>-1&&(o.unregisterCallback(t),0===o.callbacks.length&&delete this.events[e])}}class Engine{constructor(){if(Engine.instance)return Engine.instance;Engine.instance=this,this.analysers={},this.sharedArrayBuffers={},this.dispatcher=new Dispatcher,this.samplesLoaded=!1}addEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error adding event listener to Engine");this.dispatcher.addEventListener(e,t)}asyncPostToProcessor(e){if(!(e&&this.audioWorkletNode&&this.audioWorkletNode.port))throw new Error("Error async posting to processor");console.log("DEBUG:AudioEngine:onMessagingEventHandler:"),console.log(e),this.audioWorkletNode.port.postMessage(e)}createSharedBuffer(e,t,o){let i=RingBuffer.getStorageForCapacity(32*o,Float64Array),l=new RingBuffer(i,Float64Array);return this.audioWorkletNode.port.postMessage({func:"sab",value:i,ttype:t,channelID:e,blocksize:o}),this.sharedArrayBuffers[e]={sab:i,rb:l},i}pushSharedBuffer(e){let t=new RingBuffer(e.value,Float64Array);this.audioWorkletNode.port.postMessage({func:"sab",value:e.value,ttype:e.ttype,channelID:e.channelID,blocksize:e.blocksize}),this.sharedArrayBuffers[e.channelID]={sab:e.value,rb:t}}pushDataToSharedBuffer(e,t){if(!(e&&t&&(Array.isArray(t),1)))throw new Error("Error in function parameters");this.sharedArrayBuffers&&this.sharedArrayBuffers[e]&&this.sharedArrayBuffers[e].rb.push(t)}pollAnalyserData(e){if(void 0!==e){const t=new Uint8Array(e.fftSize),o=new Uint8Array(e.fftSize);return e.getByteTimeDomainData(t),e.getByteFrequencyData(o),{smoothingTimeConstant:e.smoothingTimeConstant,fftSize:e.fftSize,frequencyDataArray:o,timeDataArray:t}}}createAnalyser(e,t){if(void 0!==this.audioContext&&void 0!==e&&void 0!==t){let o=this.audioContext.createAnalyser();o.smoothingTimeConstant=.25,o.fftSize=256,o.minDecibels=-90,o.maxDecibels=-0,this.audioWorkletNode.connect(o);let i=-1,l={};this.analysers[e]={analyser:o,analyserFrameId:i,callback:t};const s=()=>(l=this.pollAnalyserData(this.analysers[e].analyser),this.analysers[e].callback(l),this.analysers[e].analyserFrameId=requestAnimationFrame(s),i);s()}else void 0===this.audioContext&&(this.analysers[e]={callback:t})}connectAnalysers(){Object.keys(this.analysers).map((e=>this.createAnalyser(e,this.analysers[e].callback)))}removeAnalyser(e){if(void 0!==this.audioContext&&void 0!==this.audioWorkletNode){void 0!==this.analysers[e.id]&&(cancelAnimationFrame(this.analysers[e.id].analyserFrameId),delete this.analysers[e.id])}}async init(e,t){if(e&&t&&new URL(t)){return this.audioContext,this.audioWorkletName=e,this.audioWorkletUrl=t,void 0===this.audioContext&&(this.audioContext=new AudioContext({latencyHint:"playback"})),!!await this.loadWorkletProcessorCode()&&(this.connectWorkletNode(),!0)}throw new Error("Name and valid URL required for AudioWorklet processor")}play(){if(void 0!==this.audioContext)return"suspended"!==this.audioContext.state?(this.stop(),!1):(this.audioContext.resume(),!0)}stop(){void 0!==this.audioWorkletNode&&this.audioContext.suspend()}stopAndRelease(){void 0!==this.audioWorkletNode&&(this.audioWorkletNode.disconnect(this.audioContext.destination),this.audioWorkletNode=void 0)}more(e){if(void 0!==this.audioWorkletNode){const t=this.audioWorkletNode.parameters.get(e);return t.value+=.5,console.log(e+": "+t.value),!0}return!1}less(e){if(void 0!==this.audioWorkletNode){const t=this.audioWorkletNode.parameters.get(e);return t.value-=.5,console.log(e+": "+t.value),!0}return!1}eval(e){return!(!this.audioWorkletNode||!this.audioWorkletNode.port)&&("suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioWorkletNode.port.postMessage({eval:1,setup:e.setup,loop:e.loop}),!0)}sendClockPhase(e,t){void 0!==this.audioWorkletNode&&this.audioWorkletNode.port.postMessage({phase:e,i:t})}onAudioInputInit(e){this.audioContext.createMediaStreamSource(e).connect(this.audioWorkletNode)}onAudioInputFail(e){console.error(`ERROR:Engine:AudioInputFail: ${e.message} ${e.name}`)}async connectMediaStream(){const e=window.constraints={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(e).then((e=>this.onAudioInputInit(e))).catch(this.onAudioInputFail)}async loadWorkletProcessorCode(){if(void 0===this.audioContext)return!1;try{await this.audioContext.audioWorklet.addModule(this.audioWorkletUrl)}catch(e){return console.error("ERROR:Engine:loadWorkletProcessorCode: AudioWorklet not supported in this browser: ",e.message),!1}try{return this.audioWorkletNode=new AudioWorkletNode(this.audioContext,this.audioWorkletName),this.audioWorkletNode.channelInterpretation="discrete",this.audioWorkletNode.channelCountMode="explicit",this.audioWorkletNode.channelCount=this.audioContext.destination.maxChannelCount,!0}catch(e){return console.error("ERROR:Engine:loadWorkletProcessorCode: Error on custom AudioWorklet node creation: ",e.message),!1}}connectWorkletNode(){if(void 0!==this.audioWorkletNode)try{this.audioContext.destination.channelInterpretation="discrete",this.audioContext.destination.channelCountMode="explicit",this.audioContext.destination.channelCount=this.audioContext.destination.maxChannelCount,this.audioWorkletNode.connect(this.audioContext.destination),this.audioWorkletNode.onprocessorerror=e=>console.error("ERROR:Engine: maxi-processor 'onprocess' error detected"),this.audioWorkletNode.onprocessorstatechange=e=>console.log("maxi-processor state change detected: "+audioWorkletNode.processorState),this.audioWorkletNode.port.onmessageerror=e=>console.error("ERROR:Engine: Error message from port: "+e.data),this.audioWorkletNode.port.onmessage=e=>this.onProcessorMessageHandler(e)}catch(e){console.error("ERROR:Engine: Error connecting WorkletNode: ",e.message)}}onProcessorMessageHandler(e){if(e&&e.data)if(e.data.rq&&"send"===e.data.rq)switch(e.data.ttype){case"ML":break;case"NET":this.peerNet.send(e.data.ch[0],e.data.value,e.data.ch[1])}else if(e.data.rq&&"buf"===e.data.rq)switch(e.data.ttype){case"ML":this.dispatcher.dispatch("onSharedBuffer",{sab:e.data.value,channelID:e.data.channelID,blocksize:e.data.blocksize})}}subscribeAsyncMessage(e){void 0!==e&&void 0!==this.audioWorkletNode&&(this.audioWorkletNode.port.onmessage=e)}loadSample(e,t){if(void 0===this.audioContext)throw"Audio Context is not initialised!";loadSampleToArray(this.audioContext,e,t,this.audioWorkletNode)}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var nearley=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(){function e(t,o,i){return this.id=++e.highestId,this.name=t,this.symbols=o,this.postprocess=i,this}function t(e,t,o,i){this.rule=e,this.dot=t,this.reference=o,this.data=[],this.wantedBy=i,this.isComplete=this.dot===e.symbols.length}function o(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function i(e,t){this.rules=e,this.start=t||this.rules[0].name;var o=this.byName={};this.rules.forEach((function(e){o.hasOwnProperty(e.name)||(o[e.name]=[]),o[e.name].push(e)}))}function l(){this.reset("")}function s(e,t,s){if(e instanceof i){var n=e;s=t}else n=i.fromCompiled(e,t);for(var r in this.grammar=n,this.options={keepHistory:!1,lexer:n.lexer||new l},s||{})this.options[r]=s[r];this.lexer=this.options.lexer,this.lexerState=void 0;var g=new o(n,0);this.table=[g],g.wants[n.start]=[],g.predict(n.start),g.process(),this.current=0}function n(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(n).join(" "):this.symbols.slice(0,e).map(n).join(" ")+" ● "+this.symbols.slice(e).map(n).join(" ");return this.name+" → "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var o=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return o.left=this,o.right=e,o.isComplete&&(o.data=o.build(),o.right=void 0),o},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,s.fail))},o.prototype.process=function(e){for(var t=this.states,o=this.wants,i=this.completed,l=0;l<t.length;l++){var n=t[l];if(n.isComplete){if(n.finish(),n.data!==s.fail){for(var r=n.wantedBy,g=r.length;g--;){var a=r[g];this.complete(a,n)}if(n.reference===this.index){var I=n.rule.name;(this.completed[I]=this.completed[I]||[]).push(n)}}}else{if("string"!=typeof(I=n.rule.symbols[n.dot])){this.scannable.push(n);continue}if(o[I]){if(o[I].push(n),i.hasOwnProperty(I)){var c=i[I];for(g=0;g<c.length;g++){var C=c[g];this.complete(n,C)}}}else o[I]=[n],this.predict(I)}}},o.prototype.predict=function(e){for(var o=this.grammar.byName[e]||[],i=0;i<o.length;i++){var l=o[i],s=this.wants[e],n=new t(l,0,this.index,s);this.states.push(n)}},o.prototype.complete=function(e,t){var o=e.nextState(t);this.states.push(o)},i.fromCompiled=function(t,o){var l=t.Lexer;t.ParserStart&&(o=t.ParserStart,t=t.ParserRules);var s=new i(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),o);return s.lexer=l,s},l.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},l.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},l.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},l.prototype.formatError=function(e,t){var o=this.buffer;if("string"==typeof o){var i=o.split("\n").slice(Math.max(0,this.line-5),this.line),l=o.indexOf("\n",this.index);-1===l&&(l=o.length);var s=this.index-this.lastLineBreak,n=String(this.line).length;return t+=" at line "+this.line+" col "+s+":\n\n",t+=i.map((function(e,t){return r(this.line-i.length+t+1,n)+" "+e}),this).join("\n"),t+="\n"+r("",n+s)+"^\n"}return t+" at index "+(this.index-1);function r(e,t){var o=String(e);return Array(t-o.length+1).join(" ")+o}},s.fail={},s.prototype.feed=function(e){var t,i=this.lexer;for(i.reset(e,this.lexerState);;){try{if(!(t=i.next()))break}catch(e){var s=new o(this.grammar,this.current+1);throw this.table.push(s),(g=new Error(this.reportLexerError(e))).offset=this.current,g.token=e.token,g}var n=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var r=this.current+1;s=new o(this.grammar,r),this.table.push(s);for(var g,a=void 0!==t.text?t.text:t.value,I=i.constructor===l?t.value:t,c=n.scannable,C=c.length;C--;){var p=c[C],u=p.rule.symbols[p.dot];if(u.test?u.test(I):u.type?u.type===t.type:u.literal===a){var d=p.nextState({data:I,token:t,isToken:!0,reference:r-1});s.states.push(d)}}if(s.process(),0===s.states.length)throw(g=new Error(this.reportError(t))).offset=this.current,g.token=t,g;this.options.keepHistory&&(n.lexerState=i.save()),this.current++}return n&&(this.lexerState=i.save()),this.results=this.finish(),this},s.prototype.reportLexerError=function(e){var t,o,i=e.token;return i?(t="input "+JSON.stringify(i.text[0])+" (lexer error)",o=this.lexer.formatError(i,"Syntax error")):(t="input (lexer error)",o=e.message),this.reportErrorCommon(o,t)},s.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),o=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(o,t)},s.prototype.reportErrorCommon=function(e,t){var o=[];o.push(e);var i=this.table.length-2,l=this.table[i],s=l.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===s.length?(o.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(l.states,o)):(o.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),s.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],i=t.rule.symbols[t.dot],l=this.getSymbolDisplay(i);o.push("A "+l+" based on:"),this.displayStateStack(e,o)}),this)),o.push(""),o.join("\n")},s.prototype.displayStateStack=function(e,t){for(var o,i=0,l=0;l<e.length;l++){var s=e[l],n=s.rule.toString(s.dot);n===o?i++:(i>0&&t.push("    ^ "+i+" more lines identical to this"),i=0,t.push("    "+n)),o=n}},s.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},s.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var o=e.wantedBy[0],i=[e].concat(t),l=this.buildFirstStateStack(o,i);return null===l?null:[e].concat(l)},s.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},s.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},s.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},s.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(o){o.rule.name===t&&o.dot===o.rule.symbols.length&&0===o.reference&&o.data!==s.fail&&e.push(o)})),e.map((function(e){return e.data}))},{Parser:s,Grammar:i,Rule:e}},e.exports?e.exports=o():t.nearley=o()})),moo=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,o="boolean"==typeof(new RegExp).sticky;function i(e){return e&&"[object RegExp]"===t.call(e)}function l(e){return e&&"object"==typeof e&&!i(e)&&!Array.isArray(e)}function s(e){return"("+e+")"}function n(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function r(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(i(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function g(t,o){if(l(o)||(o={match:o}),o.include)throw new Error("Matching rules cannot also include states");var s={defaultType:t,lineBreaks:!!o.error||!!o.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var n in o)e.call(o,n)&&(s[n]=o[n]);if("string"==typeof s.type&&t!==s.type)throw new Error("Type transform cannot be a string (type '"+s.type+"' for token '"+t+"')");var r=s.match;return s.match=Array.isArray(r)?r:r?[r]:[],s.match.sort((function(e,t){return i(e)&&i(t)?0:i(t)?-1:i(e)?1:t.length-e.length})),s}function a(e){return Array.isArray(e)?function(e){for(var t=[],o=0;o<e.length;o++){var i=e[o];if(i.include)for(var l=[].concat(i.include),s=0;s<l.length;s++)t.push({include:l[s]});else{if(!i.type)throw new Error("Rule has no type: "+JSON.stringify(i));t.push(g(i.type,i))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),o=[],i=0;i<t.length;i++){var s=t[i],n=e[s],r=[].concat(n);if("include"!==s){var a=[];r.forEach((function(e){l(e)?(a.length&&o.push(g(s,a)),o.push(g(s,e)),a=[]):a.push(e)})),a.length&&o.push(g(s,a))}else for(var I=0;I<r.length;I++)o.push({include:r[I]})}return o}(e)}var I=g("error",{lineBreaks:!0,shouldThrow:!0});function c(e,t){for(var l=null,g=Object.create(null),a=!0,c=null,C=[],p=[],u=0;u<e.length;u++)e[u].fallback&&(a=!1);for(u=0;u<e.length;u++){var d=e[u];if(d.include)throw new Error("Inheritance is not allowed in stateless lexers");if(d.error||d.fallback){if(l)throw!d.fallback==!l.fallback?new Error("Multiple "+(d.fallback?"fallback":"error")+" rules not allowed (for token '"+d.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+d.defaultType+"')");l=d}var m=d.match.slice();if(a)for(;m.length&&"string"==typeof m[0]&&1===m[0].length;)g[m.shift().charCodeAt(0)]=d;if(d.pop||d.push||d.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+d.defaultType+"')");if(d.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+d.defaultType+"')")}if(0!==m.length){a=!1,C.push(d);for(var A=0;A<m.length;A++){var h=m[A];if(i(h))if(null===c)c=h.unicode;else if(c!==h.unicode&&!1===d.fallback)throw new Error("If one rule is /u then all must be")}var b=n(m.map(r)),B=new RegExp(b);if(B.test(""))throw new Error("RegExp matches empty string: "+B);if(new RegExp("|"+b).exec("").length-1>0)throw new Error("RegExp has capture groups: "+B+"\nUse (?: … ) instead");if(!d.lineBreaks&&B.test("\n"))throw new Error("Rule should declare lineBreaks: "+B);p.push(s(b))}}var G=l&&l.fallback,y=o&&!G?"ym":"gm",F=o||G?"":"|";return!0===c&&(y+="u"),{regexp:new RegExp(n(p)+F,y),groups:C,fast:g,error:l||I}}function C(e,t,o){var i=e&&(e.push||e.next);if(i&&!o[i])throw new Error("Missing state '"+i+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var p=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};p.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},p.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},p.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},p.prototype.popState=function(){this.setState(this.stack.pop())},p.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var u=o?function(e,t){return e.exec(t)}:function(e,t){var o=e.exec(t);return 0===o[0].length?null:o};function d(){return this.value}if(p.prototype._getGroup=function(e){for(var t=this.groups.length,o=0;o<t;o++)if(void 0!==e[o+1])return this.groups[o];throw new Error("Cannot find token type for matched text")},p.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var o=this.buffer;if(e!==o.length){if(n=this.fast[o.charCodeAt(e)])return this._token(n,o.charAt(e),e);var i=this.re;i.lastIndex=e;var l=u(i,o),s=this.error;if(null==l)return this._token(s,o.slice(e,o.length),e);var n=this._getGroup(l),r=l[0];return s.fallback&&l.index!==e?(this.queuedGroup=n,this.queuedText=r,this._token(s,o.slice(e,l.index),e)):this._token(n,r,e)}},p.prototype._token=function(e,t,o){var i=0;if(e.lineBreaks){var l=/\n/g,s=1;if("\n"===t)i=1;else for(;l.exec(t);)i++,s=l.lastIndex}var n={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:d,offset:o,lineBreaks:i,line:this.line,col:this.col},r=t.length;if(this.index+=r,this.line+=i,0!==i?this.col=r-s+1:this.col+=r,e.shouldThrow)throw new Error(this.formatError(n,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),n},"undefined"!=typeof Symbol&&Symbol.iterator){var m=function(e){this.lexer=e};m.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},m.prototype[Symbol.iterator]=function(){return this},p.prototype[Symbol.iterator]=function(){return new m(this)}}return p.prototype.formatError=function(e,t){if(null==e){var o=this.buffer.slice(this.index);e={text:o,offset:this.index,lineBreaks:-1===o.indexOf("\n")?0:1,line:this.line,col:this.col}}var i=Math.max(0,e.offset-e.col+1),l=e.lineBreaks?e.text.indexOf("\n"):e.text.length,s=this.buffer.substring(i,e.offset+l);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+s+"\n",t+="  "+Array(e.col).join(" ")+"^"},p.prototype.clone=function(){return new p(this.states,this.state)},p.prototype.has=function(e){return!0},{compile:function(e){var t=c(a(e));return new p({start:t},"start")},states:function(e,t){var o=e.$all?a(e.$all):[];delete e.$all;var i=Object.getOwnPropertyNames(e);t||(t=i[0]);for(var l=Object.create(null),s=0;s<i.length;s++)l[b=i[s]]=a(e[b]).concat(o);for(s=0;s<i.length;s++)for(var n=l[b=i[s]],r=Object.create(null),g=0;g<n.length;g++){var I=n[g];if(I.include){var u=[g,1];if(I.include!==b&&!r[I.include]){r[I.include]=!0;var d=l[I.include];if(!d)throw new Error("Cannot include nonexistent state '"+I.include+"' (in state '"+b+"')");for(var m=0;m<d.length;m++){var A=d[m];-1===n.indexOf(A)&&u.push(A)}}n.splice.apply(n,u),g--}}var h=Object.create(null);for(s=0;s<i.length;s++){var b;h[b=i[s]]=c(l[b],!0)}for(s=0;s<i.length;s++){var B=i[s],G=h[B],y=G.groups;for(g=0;g<y.length;g++)C(y[g],B,h);var F=Object.getOwnPropertyNames(G.fast);for(g=0;g<F.length;g++)C(G.fast[F[g]],B,h)}return new p(h,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),o=Object.create(null),i=Object.getOwnPropertyNames(e),l=0;l<i.length;l++){var s=i[l],n=e[s];(Array.isArray(n)?n:[n]).forEach((function(e){if((o[e.length]=o[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+s+"')");t[e]=s}))}function r(e){return JSON.stringify(e)}var g="";for(var a in g+="switch (value.length) {\n",o){var I=o[a];g+="case "+a+":\n",g+="switch (value) {\n",I.forEach((function(e){var o=t[e];g+="case "+r(e)+": return "+r(o)+"\n"})),g+="}\n"}return g+="}\n",Function("value",g)}}},e.exports?e.exports=o():t.moo=o()})),nearleyLanguageBootstrapped=createCommonjsModule((function(e){!function(){function t(e){return e[0]}function o(e){return e[0].value}var i=moo,l=Object.assign({ws:{match:/\s+/,lineBreaks:!0,next:"main"},comment:/\#.*/,arrow:{match:/[=-]+\>/,next:"main"},js:{match:/\{\%(?:[^%]|\%[^}])*\%\}/,value:e=>e.slice(2,-2),lineBreaks:!0},word:{match:/[\w\?\+]+/,next:"afterWord"},string:{match:/"(?:[^\\"\n]|\\["\\/bfnrt]|\\u[a-fA-F0-9]{4})*"/,value:e=>JSON.parse(e),next:"main"},btstring:{match:/`[^`]*`/,value:e=>e.slice(1,-1),next:"main",lineBreaks:!0}},function(e){var t={};for(var o of e)t[o]={match:o,next:"main"};return t}([",","|","$","%","(",")",":?",":*",":+","@include","@builtin","@","]"])),s=i.states({main:Object.assign({},l,{charclass:{match:/\.|\[(?:\\.|[^\\\n])+?\]/,value:e=>new RegExp(e)}}),afterWord:Object.assign({},l,{"[":{match:"[",next:"main"}})});var n={Lexer:s,ParserRules:[{name:"final$ebnf$1",symbols:[s.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"final$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"final",symbols:["_","prog","_","final$ebnf$1"],postprocess:function(e){return e[1]}},{name:"prog",symbols:["prod"],postprocess:function(e){return[e[0]]}},{name:"prog",symbols:["prod","ws","prog"],postprocess:function(e){return[e[0]].concat(e[2])}},{name:"prod",symbols:["word","_",s.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{name:e[0],rules:e[4]}}},{name:"prod",symbols:["word",{literal:"["},"_","wordlist","_",{literal:"]"},"_",s.has("arrow")?{type:"arrow"}:arrow,"_","expression+"],postprocess:function(e){return{macro:e[0],args:e[3],exprs:e[9]}}},{name:"prod",symbols:[{literal:"@"},"_","js"],postprocess:function(e){return{body:e[2]}}},{name:"prod",symbols:[{literal:"@"},"word","ws","word"],postprocess:function(e){return{config:e[1],value:e[3]}}},{name:"prod",symbols:[{literal:"@include"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!1}}},{name:"prod",symbols:[{literal:"@builtin"},"_","string"],postprocess:function(e){return{include:e[2].literal,builtin:!0}}},{name:"expression+",symbols:["completeexpression"]},{name:"expression+",symbols:["expression+","_",{literal:"|"},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"expressionlist",symbols:["completeexpression"]},{name:"expressionlist",symbols:["expressionlist","_",{literal:","},"_","completeexpression"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"wordlist",symbols:["word"]},{name:"wordlist",symbols:["wordlist","_",{literal:","},"_","word"],postprocess:function(e){return e[0].concat([e[4]])}},{name:"completeexpression",symbols:["expr"],postprocess:function(e){return{tokens:e[0]}}},{name:"completeexpression",symbols:["expr","_","js"],postprocess:function(e){return{tokens:e[0],postprocess:e[2]}}},{name:"expr_member",symbols:["word"],postprocess:t},{name:"expr_member",symbols:[{literal:"$"},"word"],postprocess:function(e){return{mixin:e[1]}}},{name:"expr_member",symbols:["word",{literal:"["},"_","expressionlist","_",{literal:"]"}],postprocess:function(e){return{macrocall:e[0],args:e[3]}}},{name:"expr_member$ebnf$1",symbols:[{literal:"i"}],postprocess:t},{name:"expr_member$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"expr_member",symbols:["string","expr_member$ebnf$1"],postprocess:function(e){return e[1]?function(e){for(var t=e.literal,o=[],i=0;i<t.length;i++){var l=t.charAt(i);l.toUpperCase()!==l||l.toLowerCase()!==l?o.push(new RegExp("["+l.toLowerCase()+l.toUpperCase()+"]")):o.push({literal:l})}return{subexpression:[{tokens:o,postprocess:function(e){return e.join("")}}]}}(e[0]):e[0]}},{name:"expr_member",symbols:[{literal:"%"},"word"],postprocess:function(e){return{token:e[1]}}},{name:"expr_member",symbols:["charclass"],postprocess:t},{name:"expr_member",symbols:[{literal:"("},"_","expression+","_",{literal:")"}],postprocess:function(e){return{subexpression:e[2]}}},{name:"expr_member",symbols:["expr_member","_","ebnf_modifier"],postprocess:function(e){return{ebnf:e[0],modifier:e[2]}}},{name:"ebnf_modifier",symbols:[{literal:":+"}],postprocess:o},{name:"ebnf_modifier",symbols:[{literal:":*"}],postprocess:o},{name:"ebnf_modifier",symbols:[{literal:":?"}],postprocess:o},{name:"expr",symbols:["expr_member"]},{name:"expr",symbols:["expr","ws","expr_member"],postprocess:function(e){return e[0].concat([e[2]])}},{name:"word",symbols:[s.has("word")?{type:"word"}:word],postprocess:o},{name:"string",symbols:[s.has("string")?{type:"string"}:string],postprocess:e=>({literal:e[0].value})},{name:"string",symbols:[s.has("btstring")?{type:"btstring"}:btstring],postprocess:e=>({literal:e[0].value})},{name:"charclass",symbols:[s.has("charclass")?{type:"charclass"}:charclass],postprocess:o},{name:"js",symbols:[s.has("js")?{type:"js"}:js],postprocess:o},{name:"_$ebnf$1",symbols:["ws"],postprocess:t},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_",symbols:["_$ebnf$1"]},{name:"ws",symbols:[s.has("ws")?{type:"ws"}:ws]},{name:"ws$ebnf$1",symbols:[s.has("ws")?{type:"ws"}:ws],postprocess:t},{name:"ws$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"ws",symbols:["ws$ebnf$1",s.has("comment")?{type:"comment"}:comment,"_"]}],ParserStart:"final"};e.exports=n}()}));function compileLowLevel(e,t){var o=uniquer();t.alreadycompiled||(t.alreadycompiled=[]);for(var i={rules:[],body:[],config:{},customTokens:[],macros:{},start:""},l=0;l<e.length;l++){var s=e[l];if(c(s.name,s.pos,s.name&&s.name.length),s.body)t.nojs||i.body.push(s.body);else if(s.include){var n;if(n=s.builtin?s.include:require("path").resolve(t.file?require("path").dirname(t.file):process.cwd(),s.include),-1===t.alreadycompiled.indexOf(n)){if(t.alreadycompiled.push(n),"postprocessors.ne"===n)var r=require("nearley/builtin/postprocessors.ne");else if("whitespace.ne"===n)r=require("nearley/builtin/whitespace.ne");else if("string.ne"===n)r=require("nearley/builtin/string.ne");else if("number.ne"===n)r=require("nearley/builtin/number.ne");else if("cow.ne"===n)r=require("nearley/builtin/cow.ne");var g=nearley.Grammar.fromCompiled(nearleyLanguageBootstrapped),a=new nearley.Parser(g);a.feed(r);var I=Compile(a.results[0],{file:n,__proto__:t});i.rules=i.rules.concat(I.rules),i.body=i.body.concat(I.body),Object.keys(I.config).forEach((function(e){i.config[e]=I.config[e]})),Object.keys(I.macros).forEach((function(e){i.macros[e]=I.macros[e]}))}}else s.macro?i.macros[s.macro]={args:s.args,exprs:s.exprs}:s.config?i.config[s.config]=s.value:(C(s.name,s.rules,{}),i.start||(i.start=s.name))}return i;function c(e,o,i){t.rangeCallback&&t.rangeCallback(e,o,o+i)}function C(e,o,l){for(var s=0;s<o.length;s++){var n=p(e,o[s],l);t.nojs&&(n.postprocess=null),i.rules.push(n)}}function p(e,t,o){for(var i=[],l=0;l<t.tokens.length;l++){var s=u(e,t.tokens[l],o);null!==s&&i.push(s)}return new nearley.Rule(e,i,t.postprocess)}function u(e,t,l){if("string"==typeof t)return"null"===t?null:t;if(t instanceof RegExp)return t;if(t.literal)return t.literal.length?1===t.literal.length||i.config.lexer?t:function(e,t,i){var l=o(e+"$string");return c(l,t.pos,JSON.stringify(t.literal).length),C(l,[{tokens:t.literal.split("").map((function(e){return{literal:e}})),postprocess:{builtin:"joiner"}}],i),l}(e,t,l):null;if(t.token){if(i.config.lexer){var s=t.token;return-1===i.customTokens.indexOf(s)&&i.customTokens.push(s),{token:"("+(i.config.lexer+".has("+JSON.stringify(s)+") ? {type: "+JSON.stringify(s)+"} : "+s)+")"}}return t}if(t.subexpression)return function(e,t,i){var l=t.subexpression,s=o(e+"$subexpression");return C(s,l,i),s}(e,t,l);if(t.ebnf)return function(e,t,i){switch(t.modifier){case":+":return function(e,t,i){var l=o(e+"$ebnf");return C(l,[{tokens:[t.ebnf]},{tokens:[t.ebnf,l],postprocess:{builtin:"arrconcat"}}],i),l}(e,t,i);case":*":return function(e,t,i){var l=o(e+"$ebnf");return C(l,[{tokens:[]},{tokens:[t.ebnf,l],postprocess:{builtin:"arrconcat"}}],i),l}(e,t,i);case":?":return function(e,t,i){var l=o(e+"$ebnf");return C(l,[{tokens:[t.ebnf],postprocess:{builtin:"id"}},{tokens:[],postprocess:{builtin:"nuller"}}],i),l}(e,t,i)}}(e,t,l);if(t.macrocall)return function(e,t,l){var s=o(e+"$macrocall"),n=i.macros[t.macrocall];if(!n)throw new Error("Unkown macro: "+t.macrocall);if(n.args.length!==t.args.length)throw new Error("Argument count mismatch.");for(var r={__proto__:l},g=0;g<n.args.length;g++){var a=o(e+"$macrocall");r[n.args[g]]=a,C(a,[t.args[g]],l)}return C(s,n.exprs,r),s}(e,t,l);if(t.mixin){if(l[t.mixin])return u(e,l[t.mixin],l);throw new Error("Unbound variable: "+t.mixin)}throw new Error("unrecognized token: "+JSON.stringify(t))}}function uniquer(){var e={};return function(t){var o=e[t]=(e[t]||0)+1;return t+"$"+o}}var generate=createCommonjsModule((function(e){var t,o;t=commonjsGlobal,o=function(e){function t(e,t,s){return null==s&&(s=""),"[\n    "+e.map((function(e){return function(e,t){var s="{";return s+='"name": '+JSON.stringify(e.name),s+=', "symbols": ['+e.symbols.map(l).join(", ")+"]",e.postprocess&&(e.postprocess.builtin&&(e.postprocess=t[e.postprocess.builtin]),s+=', "postprocess": '+i(o(e.postprocess),"        ",{indentFirst:!1})),s+="}"}(e,t)})).join(",\n    ")+"\n"+s+"]"}function o(e){var t=e.toString().split(/\n/);if(1===t.length)return[t[0].replace(/^\s+|\s+$/g,"")];for(var o=null,i=t.slice(1),l=0;l<i.length;l++){var s=/^\s*/.exec(i[l]);s&&s[0].length!==i[l].length&&(null===o||s[0].length<o.length)&&(o=s[0])}return null===o?t:t.map((function(e){return e.slice(0,o.length)===o?e.slice(o.length):e}))}function i(e,t,o){var i;return i=Array.isArray(e)?e:e.toString().split("\n"),o=o||{},i.map((function(e,i){var l=!0;return 0!=i||o.indentFirst||(l=!1),l?t+e:e})).join("\n")}function l(e){return e instanceof RegExp?e.toString():e.token?e.token:JSON.stringify(e)}var s=function(e,t){if(e.config.preprocessor||(e.config.preprocessor="_default"),!s[e.config.preprocessor])throw new Error("No such preprocessor: "+e.config.preprocessor);return s[e.config.preprocessor](e,t)};return s.js=s._default=s.javascript=function(e,o){var i="// Generated automatically by nearley, version "+e.version+"\n";return i+="// http://github.com/Hardmath123/nearley\n",i+="(function () {\n",i+="function id(x) { return x[0]; }\n",i+=e.body.join("\n"),i+="var grammar = {\n",i+="    Lexer: "+e.config.lexer+",\n",i+="    ParserRules: "+t(e.rules,s.javascript.builtinPostprocessors)+"\n",i+="  , ParserStart: "+JSON.stringify(e.start)+"\n",i+="}\n",i+="if (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n",i+="   module.exports = grammar;\n",i+="} else {\n",i+="   window."+o+" = grammar;\n",i+="}\n",i+="})();\n"},s.javascript.builtinPostprocessors={joiner:"function joiner(d) {return d.join('');}",arrconcat:"function arrconcat(d) {return [d[0]].concat(d[1]);}",arrpush:"function arrpush(d) {return d[0].concat([d[1]]);}",nuller:"function(d) {return null;}",id:"id"},s.module=s.esmodule=function(e,o){var i="// Generated automatically by nearley, version "+e.version+"\n";return i+="// http://github.com/Hardmath123/nearley\n",i+="function id(x) { return x[0]; }\n",i+=e.body.join("\n"),i+="let Lexer = "+e.config.lexer+";\n",i+="let ParserRules = "+t(e.rules,s.javascript.builtinPostprocessors)+";\n",i+="let ParserStart = "+JSON.stringify(e.start)+";\n",i+="export default { Lexer, ParserRules, ParserStart };\n"},s.cs=s.coffee=s.coffeescript=function(e,l){var n="# Generated automatically by nearley, version "+e.version+"\n";return n+="# http://github.com/Hardmath123/nearley\n",n+="do ->\n",n+="  id = (d) -> d[0]\n",n+=i(o(e.body.join("\n")),"  ")+"\n",n+="  grammar = {\n",n+="    Lexer: "+e.config.lexer+",\n",n+="    ParserRules: "+i(t(e.rules,s.coffeescript.builtinPostprocessors),"      ",{indentFirst:!1})+",\n",n+="    ParserStart: "+JSON.stringify(e.start)+"\n",n+="  }\n",n+="  if typeof module != 'undefined' && typeof module.exports != 'undefined'\n",n+="    module.exports = grammar;\n",n+="  else\n",n+="    window."+l+" = grammar;\n"},s.coffeescript.builtinPostprocessors={joiner:"(d) -> d.join('')",arrconcat:"(d) -> [d[0]].concat(d[1])",arrpush:"(d) -> d[0].concat([d[1]])",nuller:"() -> null",id:"id"},s.ts=s.typescript=function(e,o){var i="// Generated automatically by nearley, version "+e.version+"\n";return i+="// http://github.com/Hardmath123/nearley\n",i+="// Bypasses TS6133. Allow declared but unused functions.\n",i+="// @ts-ignore\n",i+="function id(d: any[]): any { return d[0]; }\n",i+=e.customTokens.map((function(e){return"declare var "+e+": any;\n"})).join(""),i+=e.body.join("\n"),i+="\n",i+="interface NearleyToken {\n",i+="  value: any;\n",i+="  [key: string]: any;\n",i+="};\n",i+="\n",i+="interface NearleyLexer {\n",i+="  reset: (chunk: string, info: any) => void;\n",i+="  next: () => NearleyToken | undefined;\n",i+="  save: () => any;\n",i+="  formatError: (token: never) => string;\n",i+="  has: (tokenType: string) => boolean;\n",i+="};\n",i+="\n",i+="interface NearleyRule {\n",i+="  name: string;\n",i+="  symbols: NearleySymbol[];\n",i+="  postprocess?: (d: any[], loc?: number, reject?: {}) => any;\n",i+="};\n",i+="\n",i+="type NearleySymbol = string | { literal: any } | { test: (token: any) => boolean };\n",i+="\n",i+="interface Grammar {\n",i+="  Lexer: NearleyLexer | undefined;\n",i+="  ParserRules: NearleyRule[];\n",i+="  ParserStart: string;\n",i+="};\n",i+="\n",i+="const grammar: Grammar = {\n",i+="  Lexer: "+e.config.lexer+",\n",i+="  ParserRules: "+t(e.rules,s.typescript.builtinPostprocessors,"  ")+",\n",i+="  ParserStart: "+JSON.stringify(e.start)+",\n",i+="};\n",i+="\n",i+="export default grammar;\n"},s.typescript.builtinPostprocessors={joiner:"(d) => d.join('')",arrconcat:"(d) => [d[0]].concat(d[1])",arrpush:"(d) => d[0].concat([d[1]])",nuller:"() => null",id:"id"},s},e.exports?e.exports=o():t.generate=o(t.nearley)})),warn=function(e,t){e.out.write("WARN\t"+t+"\n")};function lintNames(e,t){var o=[];e.rules.forEach((function(e){o.push(e.name)})),e.rules.forEach((function(e){e.symbols.forEach((function(e){e.literal||e.token||e.constructor===RegExp||-1===o.indexOf(e)&&warn(t,"Undefined symbol `"+e+"` used.")}))}))}function lint(e,t){t.out||(t.out=process.stderr),lintNames(e,t)}var lint_1=lint,objectID=0,vars={},jsFuncMap={saw:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.saw(${t[0].loop})`},sin:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.sinewave(${t[0].loop})`},tri:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.triangle(${t[0].loop})`},pha:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.phasor(${t[0].loop})`},ph2:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>3?t[3].loop:0});`,loop:(e,t)=>`${e}.phasorBetween(${t[0].loop},${t[1].loop},${t[2].loop})`},sqr:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.square(${t[0].loop})`},pul:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>2?t[2].loop:0});`,loop:(e,t)=>`${e}.pulse(${t[0].loop},${t[1].loop})`},imp:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.impulse(${t[0].loop})`},sawn:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc();\n                      ${e}.phaseReset(${t.length>1?t[1].loop:0});`,loop:(e,t)=>`${e}.sawn(${t[0].loop})`},noiz:{setup:(e,t)=>`${e} = new Maximilian.maxiOsc()`,loop:(e,t)=>`${e}.noise()*${t[0].loop}`},gt:{setup:(e,t)=>"",loop:(e,t)=>`((${t[0].loop} > ${t[1].loop}) ? 1 : 0)`},lt:{setup:(e,t)=>"",loop:(e,t)=>`((${t[0].loop} < ${t[1].loop}) ? 1 : 0)`},mod:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} % ${t[1].loop})`},add:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} + ${t[1].loop})`},mul:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} * ${t[1].loop})`},sub:{setup:(e,t)=>"",loop:(e,t)=>`(${t[0].loop} - ${t[1].loop})`},div:{setup:(e,t)=>"",loop:(e,t)=>`(${t[1].loop} != 0 ? ${t[0].loop}/${t[1].loop} : 0)`},pow:{setup:(e,t)=>"",loop:(e,t)=>`Math.pow(${t[0].loop},${t[1].loop})`},abs:{setup:(e,t)=>"",loop:(e,t)=>`Math.abs(${t[0].loop})`},env:{setup:(e,t)=>`${e} = new Maximilian.maxiEnv();\n                      ${e}.setAttack(${t[1].loop});\n                      ${e}.setDecay(${t[2].loop});\n                      ${e}.setSustain(${t[3].loop});\n                      ${e}.setRelease(${t[4].loop})`,loop:(e,t)=>`${e}.adsr(1,${t[0].loop})`},sum:{setup:(e,t)=>"",loop:(e,t)=>{let o=`(${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`+${t[e].loop}`;return o+")"}},mix:{setup:(e,t)=>"",loop:(e,t)=>{let o=`((${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`+${t[e].loop}`;return o+`)/${t.length})`}},prod:{setup:(e,t)=>"",loop:(e,t)=>{let o=`(${t[0].loop}`;for(let e=1;e<t.length;e++)o+=`*${t[e].loop}`;return o+")"}},blin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, -1, 1, ${t[1].loop}, ${t[2].loop})`},ulin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, 0, 1, ${t[1].loop}, ${t[2].loop})`},bexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, -1, 1, ${t[1].loop}, ${t[2].loop})`},uexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, 0.0000001, 1, ${t[1].loop}, ${t[2].loop})`},linlin:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linlin(${t[0].loop}, ${t[1].loop}, ${t[2].loop},${t[3].loop}, ${t[4].loop})`},linexp:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiMap.linexp(${t[0].loop}, ${t[1].loop}, ${t[2].loop}, ${t[3].loop}, ${t[4].loop})`},dist:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.atanDist(${t[0].loop},${t[1].loop})`},softclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.softclip(${t[0].loop})`},hardclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.hardclip(${t[0].loop})`},asymclip:{setup:(e,t)=>`${e} = new Maximilian.maxiNonlinearity()`,loop:(e,t)=>`${e}.asymclip(${t[0].loop},${t[1].loop},${t[2].loop})`},flange:{setup:(e,t)=>`${e} = new Maximilian.maxiFlanger()`,loop:(e,t)=>`${e}.flange(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},${t[4].loop})`},chor:{setup:(e,t)=>`${e} = new Maximilian.maxiChorus()`,loop:(e,t)=>`${e}.chorus(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},${t[4].loop})`},dl:{setup:(e,t)=>`${e} = new Maximilian.maxiDelayline()`,loop:(e,t)=>`${e}.dl(${t[0].loop},${t[1].loop},${t[2].loop})`},lpf:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.lopass(${t[0].loop},${t[1].loop})`},hpf:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.hipass(${t[0].loop},${t[1].loop})`},lpz:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.lores(${t[0].loop},${t[1].loop},${t[2].loop})`},hpz:{setup:(e,t)=>`${e} = new Maximilian.maxiFilter()`,loop:(e,t)=>`${e}.hires(${t[0].loop},${t[1].loop},${t[2].loop})`},toJS:{setup:(e,t)=>`${e} = new SABOutputTransducer(outputSABs,\n                                      this.port,\n                                      'ML',\n                                      ${t[1].loop},\n                                      this.currentSample,\n                                      ${3==t.length?1:t[3].loop})`,loop:(e,t)=>`${e}.send(${t[0].loop}, ${t[2].loop})`},fromJS:{setup:(e,t)=>`${e} = new SABInputTransducer(${t[0].loop}, ${2==t.length?1:0})`,loop:(e,t)=>`${e}.getSABValue(inputSABs, ${2==t.length?t[1].loop:0})`},mouseX:{setup:(e,t)=>"",loop:(e,t)=>"this.getSABValue('mxy')[0]"},mouseY:{setup:(e,t)=>"",loop:(e,t)=>"this.getSABValue('mxy')[1]"},at:{setup:(e,t)=>"",loop:(e,t)=>`${t[0].loop}[Math.min(${t[1].loop}, ${t[0].loop}.length-1)]`},sah:{setup:(e,t)=>`${e} = new Maximilian.maxiSampleAndHold();`,loop:(e,t)=>`${e}.sah(${t[0].loop},${t[1].loop})`},stretch:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[4].loop}));\n                      ${e}stretch = new Maximilian.maxiStretch();\n                      ${e}stretch.setSample(${e});`,loop:(e,t)=>`(${e}.isReady() ? ${e}stretch.play(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},0.0) : 0.0)`},adc:{setup:(e,t)=>"",loop:(e,t)=>`(inputs * ${t[0].loop})`},sampler:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[t.length-1].loop}));`,loop:(e,t)=>{let o=`${t[0].loop}`;return 3==t.length?o+=`,${t[1].loop}`:4==t.length&&(o+=`,${t[1].loop},${t[2].loop}`),`(${e}.isReady() ? ${e}.playOnZX(${o}) : 0.0)`}},loop:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[1].loop}));`,loop:(e,t)=>`(${e}.isReady() ? ${e}.play(${t[0].loop}) : 0.0)`},slice:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[2].loop}));`,loop:(e,t)=>`(${e}.isReady() ? ${e}.loopSetPosOnZX(${t[0].loop},${t[1].loop}) : 0.0)`},oscin:{setup:(e,t)=>"",loop:(e,t)=>`this.OSCTransducer(${t[0].loop},${t[1].loop})`},oscout:{setup:(e,t)=>"",loop:(e,t)=>`this.OSCTransducer(${t[0].loop},${t[1].loop})`},sah:{setup:(e,t)=>`${e} = new Maximilian.maxiSampleAndHold();`,loop:(e,t)=>`${e}.sah(${t[0].loop},${t[1].loop})`},stretch:{setup:(e,t)=>`${e} = new Maximilian.maxiSample();\n                      ${e}.setSample(this.getSampleBuffer(${t[4].loop}));\n                      ${e}stretch = new Maximilian.maxiStretch();\n                      ${e}stretch.setSample(${e});`,loop:(e,t)=>`(${e}.isReady() ? ${e}stretch.play(${t[0].loop},${t[1].loop},${t[2].loop},${t[3].loop},0.0) : 0.0)`},bitToSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.toSignal(${t[0].loop})`},bitToTrigSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.toTrigSignal(${t[0].loop})`},bitNeg:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.neg(${t[0].loop})`},bitInc:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.inc(${t[0].loop})`},bitDec:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.dec(${t[0].loop})`},bitAnd:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.land(${t[0].loop},${t[1].loop})`},bitOr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lor(${t[0].loop},${t[1].loop})`},bitXor:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lxor(${t[0].loop},${t[1].loop})`},bitShl:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.shl(${t[0].loop},${t[1].loop})`},bitShr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.shr(${t[0].loop},${t[1].loop})`},bitAt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.at(${t[0].loop},${t[1].loop})`},bitAdd:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.add(${t[0].loop},${t[1].loop})`},bitSub:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.sub(${t[0].loop},${t[1].loop})`},bitMul:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.mul(${t[0].loop},${t[1].loop})`},bitEq:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.eq(${t[0].loop},${t[1].loop})`},bitGt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.gt(${t[0].loop},${t[1].loop})`},bitGte:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.gte(${t[0].loop},${t[1].loop})`},bitLte:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lte(${t[0].loop},${t[1].loop})`},bitLt:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.lt(${t[0].loop},${t[1].loop})`},setup:(e,t)=>"",bitDiv:{loop:(e,t)=>`Maximilian.maxiBits.div(${t[0].loop},${t[1].loop})`},bitr:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.at(${t[0].loop},${t[1].loop},${t[2].loop})`},bitnoise:{setup:(e,t)=>"",loop:(e,t)=>"Maximilian.maxiBits.noise()"},btime:{setup:(e,t)=>"",loop:(e,t)=>"this.bitTime"},bitFromSig:{setup:(e,t)=>"",loop:(e,t)=>`Maximilian.maxiBits.fromSignal(${t[0].loop})`},clp:{setup:(e,t)=>"",loop:(e,t)=>`this.clockPhase(${t[0].loop},${t.length>1?t[1].loop:0})`},clt:{setup:(e,t)=>"",loop:(e,t)=>`this.clockTrig(${t[0].loop},${t.length>1?t[1].loop:0})`},clk:{setup:(e,t)=>"",loop:(e,t)=>`(()=>{this.setBPM(${t[0].loop}); this.setBeatsPerBar(${t[1].loop});})()`},onzx:{setup:(e,t)=>`${e} = new Maximilian.maxiTrigger();`,loop:(e,t)=>`${e}.onZX(${t[0].loop})`},onchange:{setup:(e,t)=>`${e} = new Maximilian.maxiTrigger();`,loop:(e,t)=>`${e}.onChanged(${t[0].loop},${t[1].loop})`},count:{setup:(e,t)=>`${e} = new Maximilian.maxiCounter();`,loop:(e,t)=>`${e}.count(${t[0].loop},${t[1].loop})`},idx:{setup:(e,t)=>`${e} = new Maximilian.maxiIndex();`,loop:(e,t)=>`${e}.pull(${t[0].loop},${t[1].loop},${t[2].loop})`},svf:{setup:(e,t)=>`${e} = new Maximilian.maxiSVF();\n                      ${e}_p1 = new Maximilian.maxiTrigger();\n                      ${e}_p2 = new Maximilian.maxiTrigger();`,loop:(e,t)=>`( () => { ${e}_cutoff = ${t[1].loop};\n                                if (${e}_p1.onChanged(${e}_cutoff, 1e-5)) {${e}.setCutoff(${e}_cutoff)};\n                                ${e}_res = ${t[2].loop};\n                                if (${e}_p2.onChanged(${e}_res, 1e-5)) {${e}.setResonance(${e}_res)};\n                                return ${e}.play(${t[0].loop},${t[3].loop},${t[4].loop},${t[5].loop},${t[6].loop})})()`},bitclock:{setup:(e,t)=>"",loop:(e,t)=>"this.bitclock"},pvshift:{setup:(e,t)=>`${e} = new pvshift();`,loop:(e,t)=>`${e}.play(${t[0].loop},${t[1].loop})`},rsq:{setup:(e,t)=>`${e} = new Maximilian.maxiRatioSeq();`,loop:(e,t)=>2==t.length?`${e}.playTrig(${t[0].loop},${t[1].loop})`:`${e}.playValues(${t[0].loop},${t[1].loop},${t[2].loop})`},o303:{setup:(e,t)=>`${e} = new Open303.Open303();\n                      ${e}.setSampleRate(sampleRate);\n                      ${e}_tnote = new Maximilian.maxiTrigger();\n                      ${e}_twf = new Maximilian.maxiTrigger();\n                      ${e}_tcut = new Maximilian.maxiTrigger();\n                      ${e}_tres = new Maximilian.maxiTrigger();\n                      ${e}_tenvm = new Maximilian.maxiTrigger();\n                      ${e}_tdec = new Maximilian.maxiTrigger();\n                      ${e}_tnoteoff = new Maximilian.maxiTrigger();\n                      ${e}_tatt = new Maximilian.maxiTrigger();`,loop:(e,t)=>`(()=>{\n\t\t\tlet newNote = ${e}_tnote.onZX(${t[0].loop});\n\t\t\tlet accent = ${t[3].loop};\n\t\t\tif (newNote) {\n\t\t\t\tif (${t[2].loop}>0) {\n\t\t\t\t\t${e}.slideToNote(${t[1].loop},accent);\n\t\t\t\t}else{\n\t\t\t\t\t${e}.triggerNote(${t[1].loop},accent);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (${e}_tnoteoff.onChanged(${t[4].loop}, 1e-5)) {${e}.allNotesOff()};\n\t\t\tif (${e}_twf.onChanged(${t[5].loop}, 1e-5)) {${e}.setWaveform(${t[5].loop})};\n\t\t\tif (${e}_tcut.onChanged(${t[6].loop}, 1e-5)) {${e}.setCutoff(${t[6].loop})};\n\t\t\tif (${e}_tres.onChanged(${t[7].loop}, 1e-5)) {${e}.setResonance(${t[7].loop})};\n\t\t\tif (${e}_tenvm.onChanged(${t[8].loop}, 1e-5)) {${e}.setEnvMod(${t[8].loop})};\n\t\t\tif (${e}_tatt.onChanged(${t[9].loop}, 1e-5)) {${e}.setNormalAttack(${t[9].loop})};\n\t\t\tif (${e}_tdec.onChanged(${t[10].loop}, 1e-5)) {${e}.setDecay(${t[10].loop})};\n\t\t\t${e}.setAccent(${t[11].loop});\n\t\t\treturn ${e}.play();})()`},freeverb:{setup:(e,t)=>`${e} = new Maximilian.maxiFreeVerb();`,loop:(e,t)=>`${e}.play(${t[0].loop},${t[1].loop},${t[2].loop})`},line:{setup:(e,t)=>`${e} = new Maximilian.maxiLine(); ${e}.prepare(0,1,${t[1].loop}, false); ${e}.triggerEnable(1);`,loop:(e,t)=>`${e}.play(${t[0].loop})`},const:{setup:(e,t)=>"",loop:(e,t)=>`${t[0].loop}`},poll:{setup:(e,t)=>`${e} = new poll()`,loop:(e,t)=>`${e}.play(${t[0].loop})`},dac:{setup:(e,t)=>"",loop:(e,t)=>1==t.length?`this.dacOutAll(${t[0].loop})`:`this.dacOut(${t[0].loop},${t[1].loop})`},fft:{setup:(e,t)=>`${e} = new fft(${t[1].loop}, ${t[2].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop})`},ifft:{setup:(e,t)=>`${e} = new ifft(${t[3].loop}, ${t[4].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop}, ${t[1].loop}, ${t[2].loop})`},mfcc:{setup:(e,t)=>`${e} = new mfcc(${t[1].loop}, ${t[2].loop}, ${t[3].loop})`,loop:(e,t)=>`${e}.play(${t[0].loop})`}};class ASTreeToJavascript{static getNextID(){return objectID=objectID>9999?0:++objectID}static emptyCode(){return{setup:"",loop:"",paramMarkers:[]}}static traverseTree(e,t,o,i,l){let s={"@lang":(e,t)=>(t.map((t=>{let s=ASTreeToJavascript.traverseTree(t,ASTreeToJavascript.emptyCode(),o,i,l);e.setup+=s.setup,e.loop+=s.loop})),e),"@spawn":(e,t)=>((e=ASTreeToJavascript.traverseTree(t,e,o,i,l)).loop+=";",e),"@sigp":(e,t)=>{let s=[{s:t.paramBegin,e:t.paramEnd,l:o}];e.paramMarkers=e.paramMarkers.concat(s);let n=t["@func"].value,r=jsFuncMap[n],g="q.b"+l+"u"+ASTreeToJavascript.getNextID(),a=[];for(let e=0;e<t["@params"].length;e++){let s=ASTreeToJavascript.emptyCode();s=ASTreeToJavascript.traverseTree(t["@params"][e],s,o+1,i,l),a[e]=s}let I="";for(let t in a)I+=a[t].setup,e.paramMarkers=e.paramMarkers.concat(a[t].paramMarkers);return e.setup+=`${I} ${r.setup(g,a)};`,e.loop+=`${r.loop(g,a)}`,e},"@setvar":(e,t)=>{let s=t["@varname"],n=i[s];null==n&&(n=Object.keys(i).length,i[s]=n);let r=ASTreeToJavascript.traverseTree(t["@varvalue"],ASTreeToJavascript.emptyCode(),o+1,i,l);return e.setup+=r.setup,e.loop=`(mem[${n}] = ${r.loop})`,e},"@getvar":(e,t)=>{let o=i[t];return null==o&&(o=Object.keys(i).length,i[t]=o),e.loop+=`(mem[${o}] != undefined ? mem[${o}] : 0)`,e},"@string":(e,t)=>(("string"==typeof t||t instanceof String)&&(e.loop+=`'${t}'`),e),"@num":(e,t)=>(null!=t.value&&(e.loop+=`${t.value}`),e),"@list":(e,t)=>{let s="q.b"+l+"l"+ASTreeToJavascript.getNextID();e.setup+=`${s} = new Float64Array(${t.length});`,e.loop+="(()=>{";let n="";for(let r=0;r<t.length;r++){let g=ASTreeToJavascript.traverseTree(t[r],ASTreeToJavascript.emptyCode(),o,i,l);"@num"==Object.keys(t[r])[0]?e.setup+=`${s}[${r}] = ${g.loop};`:(n+=g.setup,e.loop+=`${s}[${r}] = ${g.loop};`)}return e.loop+=`return ${s}})()`,e.setup+=n,e}};return Array.isArray(e)?e.map((e=>{Object.keys(e).map((o=>{t=s[o](t,e[o])}))})):Object.keys(e).map((o=>{t=s[o](t,e[o])})),t}static treeToCode(e,t=0){vars={};let o=ASTreeToJavascript.traverseTree(e,ASTreeToJavascript.emptyCode(),0,vars,t);return o.setup=`() => {let q=this.newq(); ${o.setup}; return q;}`,o.loop=`(q, inputs, mem) => {${o.loop}}`,o}}var IR=Object.freeze({__proto__:null,default:ASTreeToJavascript}),sema=createCommonjsModule((function(e){var t;t=commonjsGlobal,e.exports?e.exports={num:function(e){return{"@num":{value:e}}},str:function(e){return{"@string":e}},synth:function(e,t){return{"@sigp":{"@params":t,"@func":{value:e}}}},setvar:function(e,t){return{"@setvar":{"@varname":e,"@varvalue":t}}},getvar:function(e){return{"@getvar":e}}}:t.sema={num:function(e){return{"@num":{value:e}}},str:function(e){return{"@string":e}},synth:function(e,t){return{"@sigp":{"@params":t,"@func":{value:e}}}},setvar:function(e,t){return{"@setvar":{"@varname":e,"@varvalue":t}}},getvar:function(e){return{"@getvar":e}}}}));function getParserModuleExports(source){let sema$1=sema;sema$1.num("3");let module={exports:""};return eval(source),module.exports}function compile(e,t){let o;const{errors:i,output:l}=compileGrammar(e),s=getParserModuleExports(l),n=new nearley.Parser(s);if(!i&&n){const e=n.feed(t);e&&(o=ASTreeToJavascript.treeToCode(e.results,0))}return{errors:i,dspCode:o}}function stream(){let e="";return{write(t){e+=t},dump:()=>e}}function AnnotatePositions(e){return e.map((e=>new nearley.Rule(e.name,e.symbols,e.postprocess&&((t,o,i)=>{var l=e.postprocess(t,o,i);return null===l?null:("object"!=typeof l||l.slice||(l.pos=o),l)}))))}function compileGrammar(e){let t=new nearley.Parser(AnnotatePositions(nearleyLanguageBootstrapped.ParserRules),nearleyLanguageBootstrapped.ParserStart,{lexer:nearleyLanguageBootstrapped.Lexer}),o=stream(),i="",l={};try{if(t.feed(e),t.results[0]){var s=compileLowLevel(t.results[0],{rangeCallback:function(e,t,o){l[e]=[t,o]}});lint_1(s,{out:o}),i=generate(s,"grammar")}}catch(e){o.write(e)}return{errors:o.dump(),positions:l,output:i}}var WorkerClass=null;try{var WorkerThreads="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");WorkerClass=WorkerThreads.Worker}catch(e){}function decodeBase64(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}function createBase64WorkerFactory(e,t,o){var i=void 0===t?null:t,l=decodeBase64(e,void 0!==o&&o),s=l.indexOf("\n",10)+1,n=l.substring(s)+(i?"//# sourceMappingURL="+i:"");return function(e){return new WorkerClass(n,Object.assign({},e,{eval:!0}))}}function decodeBase64$1(e,t){var o=atob(e);if(t){for(var i=new Uint8Array(o.length),l=0,s=o.length;l<s;++l)i[l]=o.charCodeAt(l);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return o}function createURL(e,t,o){var i=void 0===t?null:t,l=decodeBase64$1(e,void 0!==o&&o),s=l.indexOf("\n",10)+1,n=l.substring(s)+(i?"//# sourceMappingURL="+i:""),r=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(r)}function createBase64WorkerFactory$1(e,t,o){var i;return function(l){return i=i||createURL(e,t,o),new Worker(i,l)}}var kIsNodeJS="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);function isNodeJS(){return kIsNodeJS}function createBase64WorkerFactory$2(e,t,o){return isNodeJS()?createBase64WorkerFactory(e,t,o):createBase64WorkerFactory$1(e,t,o)}var WorkerFactory=createBase64WorkerFactory$2("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgdHtzdGF0aWMgZ2V0U3RvcmFnZUZvckNhcGFjaXR5KHQsZSl7aWYoIWUuQllURVNfUEVSX0VMRU1FTlQpdGhyb3ciUGFzcyBpbiBhIEFycmF5QnVmZmVyIHN1YmNsYXNzIjt2YXIgYT04Kyh0KzEpKmUuQllURVNfUEVSX0VMRU1FTlQ7cmV0dXJuIG5ldyBTaGFyZWRBcnJheUJ1ZmZlcihhKX1jb25zdHJ1Y3Rvcih0LGUpe2lmKCFBcnJheUJ1ZmZlci5fX3Byb3RvX18uaXNQcm90b3R5cGVPZihlKSYmdm9pZCAwIT09ZS5CWVRFU19QRVJfRUxFTUVOVCl0aHJvdyJQYXNzIGEgY29uY3JldGUgdHlwZWQgYXJyYXkgY2xhc3MgYXMgc2Vjb25kIGFyZ3VtZW50Ijt0aGlzLl90eXBlPWUsdGhpcy5jYXBhY2l0eT0odC5ieXRlTGVuZ3RoLTgpL2UuQllURVNfUEVSX0VMRU1FTlQsdGhpcy5idWY9dCx0aGlzLndyaXRlX3B0cj1uZXcgVWludDMyQXJyYXkodGhpcy5idWYsMCwxKSx0aGlzLnJlYWRfcHRyPW5ldyBVaW50MzJBcnJheSh0aGlzLmJ1Ziw0LDEpLHRoaXMuc3RvcmFnZT1uZXcgZSh0aGlzLmJ1Ziw4LHRoaXMuY2FwYWNpdHkpfXR5cGUoKXtyZXR1cm4gdGhpcy5fdHlwZS5uYW1lfXB1c2godCl7dmFyIGU9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksYT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7aWYoKGErMSkldGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpPT1lKXJldHVybiAwO2xldCBzPU1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV93cml0ZShlLGEpLHQubGVuZ3RoKSxuPU1hdGgubWluKHRoaXMuX3N0b3JhZ2VfY2FwYWNpdHkoKS1hLHMpLHI9cy1uO3JldHVybiB0aGlzLl9jb3B5KHQsMCx0aGlzLnN0b3JhZ2UsYSxuKSx0aGlzLl9jb3B5KHQsbix0aGlzLnN0b3JhZ2UsMCxyKSxBdG9taWNzLnN0b3JlKHRoaXMud3JpdGVfcHRyLDAsKGErcykldGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpKSxzfXBvcCh0KXt2YXIgZT1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKSxhPUF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwwKTtpZihhPT1lKXJldHVybiAwO2xldCBzPU1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV9yZWFkKGUsYSksdC5sZW5ndGgpLG49TWF0aC5taW4odGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpLWUsdC5sZW5ndGgpLHI9cy1uO3JldHVybiB0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSxlLHQsMCxuKSx0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSwwLHQsbixyKSxBdG9taWNzLnN0b3JlKHRoaXMucmVhZF9wdHIsMCwoZStzKSV0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkpLHN9ZW1wdHkoKXt2YXIgdD1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKTtyZXR1cm4gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLDApPT10fWZ1bGwoKXt2YXIgdD1BdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwwKTtyZXR1cm4oQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLDApKzEpJXRoaXMuY2FwYWNpdHkhPXR9Y2FwYWNpdHkoKXtyZXR1cm4gdGhpcy5jYXBhY2l0eS0xfWF2YWlsYWJsZV9yZWFkKCl7dmFyIHQ9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksZT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7cmV0dXJuIHRoaXMuX2F2YWlsYWJsZV9yZWFkKHQsZSl9YXZhaWxhYmxlX3dyaXRlKCl7dmFyIHQ9QXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsMCksZT1BdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsMCk7cmV0dXJuIHRoaXMuX2F2YWlsYWJsZV93cml0ZSh0LGUpfV9hdmFpbGFibGVfcmVhZCh0LGUpe3JldHVybiBlPnQ/ZS10OmUrdGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpLXR9X2F2YWlsYWJsZV93cml0ZSh0LGUpe2xldCBhPXQtZS0xO3JldHVybiBlPj10JiYoYSs9dGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpKSxhfV9zdG9yYWdlX2NhcGFjaXR5KCl7cmV0dXJuIHRoaXMuY2FwYWNpdHl9X2NvcHkodCxlLGEscyxuKXtmb3IodmFyIHI9MDtyPG47cisrKWFbcytyXT10W2Urcl19fXNlbGYuUmluZ0J1ZmZlcj10O3ZhciBlPXt9O2NsYXNzIGF7Y29uc3RydWN0b3IoYSxzLG4pe3RoaXMuY2hhbm5lbD1zLHRoaXMuYmxvY2tzaXplPW4scyBpbiBlJiZlW3NdLmJsb2Nrc2l6ZT09bj90aGlzLnJpbmdidWY9ZVtzXS5yYjoodGhpcy5zYWI9dC5nZXRTdG9yYWdlRm9yQ2FwYWNpdHkoMzIqbixGbG9hdDY0QXJyYXkpLHRoaXMucmluZ2J1Zj1uZXcgdCh0aGlzLnNhYixGbG9hdDY0QXJyYXkpLGVbc109e3JiOnRoaXMucmluZ2J1ZixzYWI6dGhpcy5zYWIsY3JlYXRlZDpEYXRlLm5vdygpLGJsb2Nrc2l6ZTpufSxwb3N0TWVzc2FnZSh7ZnVuYzoic2FiIix2YWx1ZTp0aGlzLnNhYix0dHlwZTphLGNoYW5uZWxJRDpzLGJsb2Nrc2l6ZTpufSkpfXNlbmQodCl7aWYodGhpcy5yaW5nYnVmLmF2YWlsYWJsZV93cml0ZSgpPjEpaWYoIm51bWJlciI9PXR5cGVvZiB0KXRoaXMucmluZ2J1Zi5wdXNoKG5ldyBGbG9hdDY0QXJyYXkoW3RdKSk7ZWxzZSBpZih0Lmxlbmd0aD09dGhpcy5ibG9ja3NpemUpdGhpcy5yaW5nYnVmLnB1c2godCk7ZWxzZSBpZih0Lmxlbmd0aDx0aGlzLmJsb2Nrc2l6ZSl7bGV0IGU9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmJsb2Nrc2l6ZSk7Zm9yKGxldCBhIGluIHQpZVthXT10W2FdO3RoaXMucmluZ2J1Zi5wdXNoKGUpfWVsc2UgdGhpcy5yaW5nYnVmLnB1c2godC5zbGljZSgwLHRoaXMuYmxvY2tzaXplKSl9fWZ1bmN0aW9uIHModCl7aWYobmV3IFVSTCh0KSl7dHJ5e2ltcG9ydFNjcmlwdHModCsiL2xhbG9saWIuanMiKX1jYXRjaCh0KXtjb25zb2xlLmVycm9yKCJFUlJPUjogaW1wb3J0U2NyaXB0cyDigJMgbGFsb2xpYi5qcyAiLHQpfXRyeXtpbXBvcnRTY3JpcHRzKHQrIi9zdmQuanMiKX1jYXRjaCh0KXtjb25zb2xlLmVycm9yKCJFUlJPUjogaW1wb3J0U2NyaXB0cyDigJMgc3ZkLmpzICIsdCl9dHJ5e2ltcG9ydFNjcmlwdHMoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vQHRlbnNvcmZsb3cvdGZqcy9kaXN0L3RmLm1pbi5qcyIpfWNhdGNoKHQpe2NvbnNvbGUuZXJyb3IoIkVSUk9SOiBpbXBvcnRTY3JpcHRzIOKAkyB0ZmpzIix0KX10cnl7IWZ1bmN0aW9uKCl7aWYoIXQpdmFyIHQ9ZXZhbDt0cnl7dCgnXG4gICAgICAgICAgdmFyIGxvYWRSZXNwb25kZXJzID0ge307XG4gICAgICAgICAgdmFyIGlucHV0U0FCcz17fTtcbiAgICAgICAgICB2YXIgc2VtYSA9IHtcbiAgICAgICAgICAgIHNhdmVGMzJBcnJheTogKG5hbWUsIHZhbCkgPT4ge1xuICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgImZ1bmMiOiAic2F2ZSIsXG4gICAgICAgICAgICAgICAgIm5hbWUiOiBuYW1lLFxuICAgICAgICAgICAgICAgICJ2YWwiOiB2YWxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvYWRGMzJBcnJheTogKG5hbWUsIG9ubG9hZCkgPT4ge1xuICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgImZ1bmMiOiAibG9hZCIsXG4gICAgICAgICAgICAgICAgIm5hbWUiOiBuYW1lLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgbG9hZFJlc3BvbmRlcnNbbmFtZV0gPSBvbmxvYWQ7XG4gICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRvd25sb2FkOiAobmFtZSkgPT4ge1xuICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgImZ1bmMiOiAiZG93bmxvYWQiLFxuICAgICAgICAgICAgICAgICJuYW1lIjogbmFtZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VuZENvZGU6IChjb2RlKSA9PiB7XG4gICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAiZnVuYyI6ICJzZW5kY29kZSIsXG4gICAgICAgICAgICAgICAgImNvZGUiOiBjb2RlLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYmNvcHk6IChtc2cpID0+IHtcbiAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICJmdW5jIjogInBiY29weSIsXG4gICAgICAgICAgICAgICAgIm1zZyI6IG1zZyxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VuZEJ1ZmZlcjogKGJ1ZmZlck5hbWUsZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgImZ1bmMiOiAic2VuZGJ1ZiIsXG4gICAgICAgICAgICAgICAgICAgICJuYW1lIjogYnVmZmVyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgImRhdGEiOiBkYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW52OiB7XG4gICAgICAgICAgICAgIHNhdmVMb2NhbDogKG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgImZ1bmMiOiAiZW52c2F2ZSIsXG4gICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICJzdG9yYWdlIjoibG9jYWwiXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBsb2FkTG9jYWw6IChuYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICJmdW5jIjogImVudmxvYWQiLFxuICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAic3RvcmFnZSI6ImxvY2FsIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2F2ZVRvUEI6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgImZ1bmMiOiAiZW52c2F2ZSIsXG4gICAgICAgICAgICAgICAgICAgICAgInN0b3JhZ2UiOiJwYXN0ZWJ1ZmZlciJcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGxvYWRHaXN0OiAoZ2lzdGlkKSA9PiB7XG4gICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICJmdW5jIjogImVudmxvYWQiLFxuICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogZ2lzdGlkLFxuICAgICAgICAgICAgICAgICAgICAgICJzdG9yYWdlIjoiZ2lzdCJcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvL3J1biBpbiB0aGUgRE9NXG4gICAgICAgICAgICBkb21ldmFsOiAoY29kZSkgPT4ge1xuICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICJmdW5jIjogImRvbWV2YWwiLFxuICAgICAgICAgICAgICAgICAgICAiY29kZSI6IGNvZGUsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGVlcmluZm86ICgpID0+IHtcbiAgICAgICAgICAgICAgcG9zdE1lc3NhZ2UgKHtcbiAgICAgICAgICAgICAgICAiZnVuYyI6ICJwZWVyaW5mbyJcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJZb3VyIHBlZXIgSUQgaGFzIGJlZW4gY29waWVkIHRvIHRoZSBwYXN0ZSBidWZmZXIiKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAnKX1jYXRjaCh0KXtjb25zb2xlLmVycm9yKCJFUlJPUjpldmFsOiIsdCl9fSgpfWNhdGNoKHQpe2NvbnNvbGUuZXJyb3IoIkVSUk9SOiBnZXZhbEFsbCIsdCl9dHJ5e24oKX1jYXRjaCh0KXtjb25zb2xlLmVycm9yKCJFUlJPUjogc2FiQ2hlY2tlciIsdCl9cG9zdE1lc3NhZ2Uoe2luaXQ6ITB9KX1lbHNlIGNvbnNvbGUuZXJyb3IoIkVSUk9SOiBpbml0V2l0aFVSTCDigJMgSW52YWxpZCBVUkwiKX1mdW5jdGlvbiBuKCl7dHJ5e2ZvcihsZXQgdCBpbiBpbnB1dFNBQnMpe2xldCBlPWlucHV0U0FCc1t0XS5yYi5hdmFpbGFibGVfcmVhZCgpO2lmKGUhPWlucHV0U0FCc1t0XS5yYi5jYXBhY2l0eSYmZT4wKWZvcihsZXQgYT0wO2E8ZTthKz1pbnB1dFNBQnNbdF0uYmxvY2tzaXplKXtsZXQgZT1uZXcgRmxvYXQ2NEFycmF5KGlucHV0U0FCc1t0XS5ibG9ja3NpemUpO2lucHV0U0FCc1t0XS5yYi5wb3AoZSksaW5wdXQodCxlKX19c2V0VGltZW91dChuLDIwKX1jYXRjaCh0KXtzZXRUaW1lb3V0KG4sMTAwKX19c2VsZi5jcmVhdGVPdXRwdXRDaGFubmVsPSh0LGUpPT5uZXcgYSgiTUwiLHQsZSksc2VsZi5pbnB1dD0odCxlKT0+e30sc2VsZi5vdXRwdXQ9KHQsZSk9Pntwb3N0TWVzc2FnZSh7ZnVuYzoiZGF0YSIsdmFsOnQsY2g6ZX0pfSxvbm1lc3NhZ2U9ZT0+e2lmKGUuZGF0YS51cmwmJnMoZS5kYXRhLnVybCksZS5kYXRhLmV2YWwpdHJ5e2lmKCFhKXZhciBhPWV2YWw7YShlLmRhdGEuZXZhbCl9Y2F0Y2godCl7Y29uc29sZS5lcnJvcihgRVJST1I6d29ya2VyOmdldmFsIGV4Y2VwdGlvbjogJHt0fSBgLGUuZGF0YS5ldmFsKX1lbHNlIGlmKCJ2YWwiaW4gZS5kYXRhKXtsZXQgdD1lLmRhdGEudmFsO3Q9SlNPTi5wYXJzZShgWyR7dH1dYCksbG9hZFJlc3BvbmRlcnNbZS5kYXRhLm5hbWVdKHQpLGRlbGV0ZSBsb2FkUmVzcG9uZGVyc1tlLmRhdGEubmFtZV19ZWxzZSBpZigibW9kZWwtaW5wdXQtZGF0YSI9PT1lLmRhdGEudHlwZSlpbnB1dChlLmRhdGEudmFsdWUsZS5kYXRhLmNoKTtlbHNlIGlmKGUuZGF0YS5zYWIpe2NvbnNvbGUubG9nKCJERUJVRzogU0FCIHJlY2VpdmVkIixlKTtsZXQgYT1lLmRhdGEuc2FiLHM9bmV3IHQoYSxGbG9hdDY0QXJyYXkpO2lucHV0U0FCc1tlLmRhdGEuY2hhbm5lbElEXT17c2FiOmEscmI6cyxibG9ja3NpemU6ZS5kYXRhLmJsb2Nrc2l6ZX0sY29uc29sZS5sb2coIk1MIixpbnB1dFNBQnMpfX19KCk7Cgo=","data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLmpzIiwic291cmNlcyI6WyJ3b3JrZXI6Ly93ZWItd29ya2VyL25vZGVfbW9kdWxlcy9yaW5nYnVmLmpzL2Rpc3QvaW5kZXguZXMuanMiLCJ3b3JrZXI6Ly93ZWItd29ya2VyL3NyYy9sZWFybmVyL3dvcmtlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTZW5kIGF1ZGlvIGludGVybGVhdmVkIGF1ZGlvIGZyYW1lcyBiZXR3ZWVuIHRocmVhZHMsIHdhaXQtZnJlZS5cbi8vXG4vLyBUaG9zZSBjbGFzc2VzIGFsbG93IGNvbW11bmljYXRpbmcgYmV0d2VlbiBhIG5vbi1yZWFsIHRpbWUgdGhyZWFkIChicm93c2VyXG4vLyBtYWluIHRocmVhZCBvciB3b3JrZXIpIGFuZCBhIHJlYWwtdGltZSB0aHJlYWQgKGluIGFuIEF1ZGlvV29ya2xldFByb2Nlc3NvcikuXG4vLyBXcml0ZSBhbmQgUmVhZGVyIGNhbm5vdCBjaGFuZ2Ugcm9sZSBhZnRlciBzZXR1cCwgdW5sZXNzIGV4dGVybmFsbHlcbi8vIHN5bmNocm9uaXplZC5cbi8vXG4vLyBHQyBfY2FuXyBoYXBwZW4gZHVyaW5nIHRoZSBpbml0aWFsIGNvbnN0cnVjdGlvbiBvZiB0aGlzIG9iamVjdCB3aGVuIGhvcGVmdWxseVxuLy8gbm8gYXVkaW8gaXMgYmVpbmcgb3V0cHV0LiBUaGlzIGRlcGVuZHMgb24gaG93IGltcGxlbWVudGF0aW9ucyBzY2hlZHVsZSBHQ1xuLy8gcGFzc2VzLiBBZnRlciB0aGUgc2V0dXAgcGhhc2Ugbm8gR0MgaXMgdHJpZ2dlcmVkIG9uIGVpdGhlciBzaWRlIG9mIHRoZSBxdWV1ZS4uXG5cbi8vIEludGVybGVhdmVkIC0+IFBsYW5hciBhdWRpbyBidWZmZXIgY29udmVyc2lvblxuLy9cbi8vIGBpbnB1dGAgaXMgYW4gYXJyYXkgb2YgbioxMjggZnJhbWVzIGFycmF5cywgaW50ZXJsZWF2ZWQsIHdoZXJlIG4gaXMgdGhlXG4vLyBjaGFubmVsIGNvdW50LlxuLy8gb3V0cHV0IGlzIGFuIGFycmF5IG9mIDEyOC1mcmFtZXMgYXJyYXlzLlxuLy9cbi8vIFRoaXMgaXMgdXNlZnVsIHRvIGdldCBkYXRhIGZyb20gYSBjb2RlYywgdGhlIG5ldHdvcmssIG9yIGFueXRoaW5nIHRoYXQgaXNcbi8vIGludGVybGVhdmVkLCBpbnRvIHBsYW5hciBmb3JtYXQsIGZvciBleGFtcGxlIGEgV2ViIEF1ZGlvIEFQSSBBdWRpb0J1ZmZlciBvclxuLy8gdGhlIG91dHB1dCBwYXJhbWV0ZXIgb2YgYW4gQXVkaW9Xb3JrbGV0UHJvY2Vzc29yLlxuZnVuY3Rpb24gZGVpbnRlcmxlYXZlKGlucHV0LCBvdXRwdXQpIHtcbiAgdmFyIGNoYW5uZWxfY291bnQgPSBpbnB1dC5sZW5ndGggLyAyNTY7XG4gIGlmIChvdXRwdXQubGVuZ3RoICE9IGNoYW5uZWxfY291bnQpIHtcbiAgICB0aHJvdyBcIm5vdCBlbm91Z2ggc3BhY2UgaW4gb3V0cHV0IGFycmF5c1wiO1xuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbm5lbENvdW50OyBpKyspIHtcbiAgICBsZXQgb3V0X2NoYW5uZWwgPSBvdXRwdXRbaV07XG4gICAgbGV0IGludGVybGVhdmVkX2lkeCA9IGk7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCAxMjg7ICsraikge1xuICAgICAgb3V0X2NoYW5uZWxbal0gPSBpbnB1dFtpbnRlcmxlYXZlZF9pZHhdO1xuICAgICAgaW50ZXJsZWF2ZWRfaWR4ICs9IGNoYW5uZWxfY291bnQ7XG4gICAgfVxuICB9XG59XG4vLyBQbGFuYXIgLT4gSW50ZXJsZWF2ZWQgYXVkaW8gYnVmZmVyIGNvbnZlcnNpb25cbi8vXG4vLyBJbnB1dCBpcyBhbiBhcnJheSBvZiBgbmAgMTI4IGZyYW1lcyBGbG9hdDMyQXJyYXkgdGhhdCBob2xkIHRoZSBhdWRpbyBkYXRhLlxuLy8gb3V0cHV0IGlzIGEgRmxvYXQzMkFycmF5IHRoYXQgaXMgbioxMjggZWxlbWVudHMgbG9uZy4gVGhpcyBmdW5jdGlvbiBpcyB1c2VmdWxcbi8vIHRvIGdldCBkYXRhIGZyb20gdGhlIFdlYiBBdWRpbyBBUEkgKHRoYXQgZG9lcyBwbGFuYXIgYXVkaW8pLCBpbnRvIHNvbWV0aGluZ1xuLy8gdGhhdCBjb2RlYyBvciBuZXR3b3JrIHN0cmVhbWluZyBsaWJyYXJ5IGV4cGVjdC5cbmZ1bmN0aW9uIGludGVybGVhdmUoaW5wdXQsIG91dHB1dCkge1xuICBpZiAoaW5wdXQubGVuZ3RoICogMTI4ICE9IG91dHB1dC5sZW5ndGgpIHtcbiAgICB0aHJvdyBcImlucHV0IGFuZCBvdXRwdXQgb2YgaW5jb21wYXRpYmxlIHNpemVzXCI7XG4gIH1cbiAgdmFyIG91dF9pZHggPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IDEyODsgaSsrKSB7XG4gICAgZm9yICh2YXIgY2hhbm5lbCA9IDA7IGogPCBvdXRwdXQubGVuZ3RoOyBqKyspIHtcbiAgICAgIG91dHB1dFtvdXRfaWR4XSA9IGlucHV0W2NoYW5uZWxdW2ldO1xuICAgICAgb3V0X2lkeCsrO1xuICAgIH1cbiAgfVxufVxuXG5jbGFzcyBBdWRpb1dyaXRlciB7XG4gIC8vIEZyb20gYSBSaW5nQnVmZmVyLCBidWlsZCBhbiBvYmplY3QgdGhhdCBjYW4gZW5xdWV1ZSBlbnF1ZXVlIGF1ZGlvIGluIGEgcmluZ1xuICAvLyBidWZmZXIuXG4gIGNvbnN0cnVjdG9yKHJpbmdidWYpIHtcbiAgICBpZiAocmluZ2J1Zi50eXBlKCkgIT0gXCJGbG9hdDMyQXJyYXlcIikge1xuICAgICAgdGhyb3cgXCJUaGlzIGNsYXNzIHJlcXVpcmVzIGEgcmluZyBidWZmZXIgb2YgRmxvYXQzMkFycmF5XCI7XG4gICAgfVxuICAgIHRoaXMucmluZ2J1ZiA9IHJpbmdidWY7XG4gIH1cbiAgLy8gRW5xdWV1ZSBhIGJ1ZmZlciBvZiBpbnRlcmxlYXZlZCBhdWRpbyBpbnRvIHRoZSByaW5nIGJ1ZmZlci5cbiAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNhbXBsZXMgdGhhdCBoYXZlIGJlZW4gc3VjY2Vzc2Z1bHkgd3JpdHRlbiB0byB0aGVcbiAgLy8gcXVldWUuIGBidWZgIGlzIG5vdCB3cml0dGVuIHRvIGR1cmluZyB0aGlzIGNhbGwsIHNvIHRoZSBzYW1wbGVzIHRoYXRcbiAgLy8gaGF2ZW4ndCBiZWVuIHdyaXR0ZW4gdG8gdGhlIHF1ZXVlIGFyZSBzdGlsbCBhdmFpbGFibGUuXG4gIGVucXVldWUoYnVmKSB7XG4gICAgcmV0dXJuIHRoaXMucmluZ2J1Zi5wdXNoKGJ1Zik7XG4gIH1cbiAgLy8gUXVlcnkgdGhlIGZyZWUgc3BhY2UgaW4gdGhlIHJpbmcgYnVmZmVyLiBUaGlzIGlzIHRoZSBhbW91bnQgb2Ygc2FtcGxlcyB0aGF0XG4gIC8vIGNhbiBiZSBxdWV1ZWQsIHdpdGggYSBndWFyYW50ZWUgb2Ygc3VjY2Vzcy5cbiAgYXZhaWxhYmxlX3dyaXRlKCkge1xuICAgIHJldHVybiB0aGlzLnJpbmdidWYuYXZhaWxhYmxlX3dyaXRlKCk7XG4gIH1cbn1cblxuY2xhc3MgQXVkaW9SZWFkZXIge1xuICBjb25zdHJ1Y3RvcihyaW5nYnVmKSB7XG4gICAgaWYgKHJpbmdidWYudHlwZSgpICE9IFwiRmxvYXQzMkFycmF5XCIpIHtcbiAgICAgIHRocm93IFwiVGhpcyBjbGFzcyByZXF1aXJlcyBhIHJpbmcgYnVmZmVyIG9mIEZsb2F0MzJBcnJheVwiO1xuICAgIH1cbiAgICB0aGlzLnJpbmdidWYgPSByaW5nYnVmO1xuICB9XG4gIC8vIEF0dGVtcHQgdG8gZGVxdWV1ZSBhdCBtb3N0IGBidWYubGVuZ3RoYCBzYW1wbGVzIGZyb20gdGhlIHF1ZXVlLiBUaGlzXG4gIC8vIHJldHVybnMgdGhlIG51bWJlciBvZiBzYW1wbGVzIGRlcXVldWVkLiBJZiBncmVhdGVyIHRoYW4gMCwgdGhlIHNhbXBsZXMgYXJlXG4gIC8vIGF0IHRoZSBiZWdpbm5pbmcgb2YgYGJ1ZmBcbiAgZGVxdWV1ZShidWYpIHtcbiAgICBpZiAodGhpcy5yaW5nYnVmLmVtcHR5KCkpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5yaW5nYnVmLnBvcChidWYpO1xuICB9XG4gIC8vIFF1ZXJ5IHRoZSBvY2N1cGllZCBzcGFjZSBpbiB0aGUgcXVldWUuIFRoaXMgaXMgdGhlIGFtb3VudCBvZiBzYW1wbGVzIHRoYXRcbiAgLy8gY2FuIGJlIHJlYWQgd2l0aCBhIGd1YXJhbnRlZSBvZiBzdWNjZXNzLlxuICBhdmFpbGFibGVfcmVhZCgpIHtcbiAgICByZXR1cm4gdGhpcy5yaW5nYnVmLmF2YWlsYWJsZV9yZWFkKCk7XG4gIH1cbn1cblxuLy8gQ29tbXVuaWNhdGUgcGFyYW1ldGVyIGNoYW5nZXMsIGxvY2sgZnJlZSwgbm8gZ2MuXG4vL1xuLy8gYmV0d2VlbiBhIFVJIHRocmVhZCAoYnJvd3NlciBtYWluIHRocmVhZCBvciB3b3JrZXIpIGFuZCBhIHJlYWwtdGltZSB0aHJlYWRcbi8vIChpbiBhbiBBdWRpb1dvcmtsZXRQcm9jZXNzb3IpLiBXcml0ZSBhbmQgUmVhZGVyIGNhbm5vdCBjaGFuZ2Ugcm9sZSBhZnRlclxuLy8gc2V0dXAsIHVubGVzcyBleHRlcm5hbGx5IHN5bmNocm9uaXplZC5cbi8vXG4vLyBHQyBjYW4gaGFwcGVuIGR1cmluZyB0aGUgaW5pdGlhbCBjb25zdHJ1Y3Rpb24gb2YgdGhpcyBvYmplY3Qgd2hlbiBob3BlZnVsbHlcbi8vIG5vIGF1ZGlvIGlzIGJlaW5nIG91dHB1dC4gVGhpcyBkZXBlbmRzIG9uIHRoZSBpbXBsZW1lbnRhdGlvbi5cbi8vXG4vLyBQYXJhbWV0ZXIgY2hhbmdlcyBhcmUgbGlrZSBpbiB0aGUgVlNUIGZyYW1ld29yazogYW4gaW5kZXggYW5kIGEgZmxvYXQgdmFsdWVcbi8vIChubyByZXN0cmljdGlvbiBvbiB0aGUgdmFsdWUpLlxuLy9cbi8vIFRoaXMgY2xhc3Mgc3VwcG9ydHMgdXAgdG8gMjU2IHBhcmFtZXRlcnMsIGJ1dCB0aGlzIGlzIGVhc3kgdG8gZXh0ZW5kIGlmXG4vLyBuZWVkZWQuXG4vL1xuLy8gQW4gZWxlbWVudCBpcyBhIGluZGV4LCB0aGF0IGlzIGFuIHVuc2lnbmVkIGJ5dGUsIGFuZCBhIGZsb2F0MzIsIHdoaWNoIGlzIDRcbi8vIGJ5dGVzLlxuXG5jbGFzcyBQYXJhbWV0ZXJXcml0ZXIge1xuICAvLyBGcm9tIGEgUmluZ0J1ZmZlciwgYnVpbGQgYW4gb2JqZWN0IHRoYXQgY2FuIGVucXVldWUgYSBwYXJhbWV0ZXIgY2hhbmdlIGluXG4gIC8vIHRoZSBxdWV1ZS5cbiAgY29uc3RydWN0b3IocmluZ2J1Zikge1xuICAgIGlmIChyaW5nYnVmLnR5cGUoKSAhPSBcIlVpbnQ4QXJyYXlcIikge1xuICAgICAgdGhyb3cgXCJUaGlzIGNsYXNzIHJlcXVpcmVzIGEgcmluZyBidWZmZXIgb2YgVWludDhBcnJheVwiO1xuICAgIH1cbiAgICBjb25zdCBTSVpFX0VMRU1FTlQgPSA1O1xuICAgIHRoaXMucmluZ2J1ZiA9IHJpbmdidWY7XG4gICAgdGhpcy5tZW0gPSBuZXcgQXJyYXlCdWZmZXIoU0laRV9FTEVNRU5UKTtcbiAgICB0aGlzLmFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5tZW0pO1xuICAgIHRoaXMudmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLm1lbSk7XG4gIH1cbiAgLy8gRW5xdWV1ZSBhIHBhcmFtZXRlciBjaGFuZ2UgZm9yIHBhcmFtZXRlciBvZiBpbmRleCBgaW5kZXhgLCB3aXRoIGEgbmV3IHZhbHVlXG4gIC8vIG9mIGB2YWx1ZWAuXG4gIC8vIFJldHVybnMgdHJ1ZSBpZiBlbnF1ZXVpbmcgc3VjZWVkZWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgZW5xdWV1ZV9jaGFuZ2UoaW5kZXgsIHZhbHVlKSB7XG4gICAgY29uc3QgU0laRV9FTEVNRU5UID0gNTtcbiAgICB0aGlzLnZpZXcuc2V0VWludDgoMCwgaW5kZXgpO1xuICAgIHRoaXMudmlldy5zZXRGbG9hdDMyKDEsIHZhbHVlKTtcbiAgICBpZiAodGhpcy5yaW5nYnVmLmF2YWlsYWJsZV93cml0ZSgpIDwgU0laRV9FTEVNRU5UKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnJpbmdidWYucHVzaCh0aGlzLmFycmF5KSA9PSBTSVpFX0VMRU1FTlQ7XG4gIH1cbn1cblxuY2xhc3MgUGFyYW1ldGVyUmVhZGVyIHtcbiAgY29uc3RydWN0b3IocmluZ2J1Zikge1xuICAgIGNvbnN0IFNJWkVfRUxFTUVOVCA9IDU7XG4gICAgdGhpcy5yaW5nYnVmID0gcmluZ2J1ZjtcbiAgICB0aGlzLm1lbSA9IG5ldyBBcnJheUJ1ZmZlcihTSVpFX0VMRU1FTlQpO1xuICAgIHRoaXMuYXJyYXkgPSBuZXcgVWludDhBcnJheSh0aGlzLm1lbSk7XG4gICAgdGhpcy52aWV3ID0gbmV3IERhdGFWaWV3KHRoaXMubWVtKTtcbiAgfVxuICBkZXF1ZXVlX2NoYW5nZShvKSB7XG4gICAgaWYgKHRoaXMucmluZ2J1Zi5lbXB0eSgpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciBydiA9IHRoaXMucmluZ2J1Zi5wb3AodGhpcy5hcnJheSk7XG4gICAgby5pbmRleCA9IHRoaXMudmlldy5nZXRVaW50OCgwKTtcbiAgICBvLnZhbHVlID0gdGhpcy52aWV3LmdldEZsb2F0MzIoMSk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG4vLyBBIFNpbmdsZSBQcm9kdWNlciAtIFNpbmdsZSBDb25zdW1lciB0aHJlYWQtc2FmZSB3YWl0LWZyZWUgcmluZyBidWZmZXIuXG4vL1xuLy8gVGhlIHByb2R1Y2VyIGFuZCB0aGUgY29uc3VtZXIgY2FuIGJlIHNlcGFyYXRlIHRocmVhZCwgYnV0IGNhbm5vdCBjaGFuZ2Ugcm9sZSxcbi8vIGV4Y2VwdCB3aXRoIGV4dGVybmFsIHN5bmNocm9uaXphdGlvbi5cblxuY2xhc3MgUmluZ0J1ZmZlciB7XG4gIHN0YXRpYyBnZXRTdG9yYWdlRm9yQ2FwYWNpdHkoY2FwYWNpdHksIHR5cGUpIHtcbiAgICBpZiAoIXR5cGUuQllURVNfUEVSX0VMRU1FTlQpIHtcbiAgICAgIHRocm93IFwiUGFzcyBpbiBhIEFycmF5QnVmZmVyIHN1YmNsYXNzXCI7XG4gICAgfVxuICAgIHZhciBieXRlcyA9IDggKyAoY2FwYWNpdHkgKyAxKSAqIHR5cGUuQllURVNfUEVSX0VMRU1FTlQ7XG4gICAgcmV0dXJuIG5ldyBTaGFyZWRBcnJheUJ1ZmZlcihieXRlcyk7XG4gIH1cbiAgLy8gYHNhYmAgaXMgYSBTaGFyZWRBcnJheUJ1ZmZlciB3aXRoIGEgY2FwYWNpdHkgY2FsY3VsYXRlZCBieSBjYWxsaW5nXG4gIC8vIGBnZXRTdG9yYWdlRm9yQ2FwYWNpdHlgIHdpdGggdGhlIGRlc2lyZWQgY2FwYWNpdHkuXG4gIGNvbnN0cnVjdG9yKHNhYiwgdHlwZSkge1xuICAgIGlmICghQXJyYXlCdWZmZXIuX19wcm90b19fLmlzUHJvdG90eXBlT2YodHlwZSkgJiZcbiAgICAgIHR5cGUuQllURVNfUEVSX0VMRU1FTlQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgXCJQYXNzIGEgY29uY3JldGUgdHlwZWQgYXJyYXkgY2xhc3MgYXMgc2Vjb25kIGFyZ3VtZW50XCI7XG4gICAgfVxuXG4gICAgLy8gTWF4aW11bSB1c2FibGUgc2l6ZSBpcyAxPDwzMiAtIHR5cGUuQllURVNfUEVSX0VMRU1FTlQgYnl0ZXMgaW4gdGhlIHJpbmdcbiAgICAvLyBidWZmZXIgZm9yIHRoaXMgdmVyc2lvbiwgZWFzaWx5IGNoYW5nZWFibGUuXG4gICAgLy8gLTQgZm9yIHRoZSB3cml0ZSBwdHIgKHVpbnQzMl90IG9mZnNldHMpXG4gICAgLy8gLTQgZm9yIHRoZSByZWFkIHB0ciAodWludDMyX3Qgb2Zmc2V0cylcbiAgICAvLyBjYXBhY2l0eSBjb3VudHMgdGhlIGVtcHR5IHNsb3QgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBmdWxsIGFuZCBlbXB0eS5cbiAgICB0aGlzLl90eXBlID0gdHlwZTtcbiAgICB0aGlzLmNhcGFjaXR5ID0gKHNhYi5ieXRlTGVuZ3RoIC0gOCkgLyB0eXBlLkJZVEVTX1BFUl9FTEVNRU5UO1xuICAgIHRoaXMuYnVmID0gc2FiO1xuICAgIHRoaXMud3JpdGVfcHRyID0gbmV3IFVpbnQzMkFycmF5KHRoaXMuYnVmLCAwLCAxKTtcbiAgICB0aGlzLnJlYWRfcHRyID0gbmV3IFVpbnQzMkFycmF5KHRoaXMuYnVmLCA0LCAxKTtcbiAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgdHlwZSh0aGlzLmJ1ZiwgOCwgdGhpcy5jYXBhY2l0eSk7XG4gIH1cbiAgLy8gUmV0dXJucyB0aGUgdHlwZSBvZiB0aGUgdW5kZXJseWluZyBBcnJheUJ1ZmZlciBmb3IgdGhpcyBSaW5nQnVmZmVyLiBUaGlzXG4gIC8vIGFsbG93cyBpbXBsZW1lbnRpbmcgY3J1ZGUgdHlwZSBjaGVja2luZy5cbiAgdHlwZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdHlwZS5uYW1lO1xuICB9XG4gIC8vIFB1c2ggYnl0ZXMgdG8gdGhlIHJpbmcgYnVmZmVyLiBgYnl0ZXNgIGlzIGFuIHR5cGVkIGFycmF5IG9mIHRoZSBzYW1lIHR5cGVcbiAgLy8gYXMgcGFzc2VkIGluIHRoZSBjdG9yLCB0byBiZSB3cml0dGVuIHRvIHRoZSBxdWV1ZS5cbiAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIHdyaXR0ZW4gdG8gdGhlIHF1ZXVlLlxuICBwdXNoKGVsZW1lbnRzKSB7XG4gICAgdmFyIHJkID0gQXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsIDApO1xuICAgIHZhciB3ciA9IEF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwgMCk7XG5cbiAgICBpZiAoKHdyICsgMSkgJSB0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkgPT0gcmQpIHtcbiAgICAgIC8vIGZ1bGxcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxldCB0b193cml0ZSA9IE1hdGgubWluKHRoaXMuX2F2YWlsYWJsZV93cml0ZShyZCwgd3IpLCBlbGVtZW50cy5sZW5ndGgpO1xuICAgIGxldCBmaXJzdF9wYXJ0ID0gTWF0aC5taW4odGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpIC0gd3IsIHRvX3dyaXRlKTtcbiAgICBsZXQgc2Vjb25kX3BhcnQgPSB0b193cml0ZSAtIGZpcnN0X3BhcnQ7XG5cbiAgICB0aGlzLl9jb3B5KGVsZW1lbnRzLCAwLCB0aGlzLnN0b3JhZ2UsIHdyLCBmaXJzdF9wYXJ0KTtcbiAgICB0aGlzLl9jb3B5KGVsZW1lbnRzLCBmaXJzdF9wYXJ0LCB0aGlzLnN0b3JhZ2UsIDAsIHNlY29uZF9wYXJ0KTtcblxuICAgIC8vIHB1Ymxpc2ggdGhlIGVucXVldWVkIGRhdGEgdG8gdGhlIG90aGVyIHNpZGVcbiAgICBBdG9taWNzLnN0b3JlKFxuICAgICAgdGhpcy53cml0ZV9wdHIsXG4gICAgICAwLFxuICAgICAgKHdyICsgdG9fd3JpdGUpICUgdGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpXG4gICAgKTtcblxuICAgIHJldHVybiB0b193cml0ZTtcbiAgfVxuICAvLyBSZWFkIGBlbGVtZW50cy5sZW5ndGhgIGVsZW1lbnRzIGZyb20gdGhlIHJpbmcgYnVmZmVyLiBgZWxlbWVudHNgIGlzIGEgdHlwZWRcbiAgLy8gYXJyYXkgb2YgdGhlIHNhbWUgdHlwZSBhcyBwYXNzZWQgaW4gdGhlIGN0b3IuXG4gIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBlbGVtZW50cyByZWFkIGZyb20gdGhlIHF1ZXVlLCB0aGV5IGFyZSBwbGFjZWQgYXQgdGhlXG4gIC8vIGJlZ2lubmluZyBvZiB0aGUgYXJyYXkgcGFzc2VkIGFzIHBhcmFtZXRlci5cbiAgcG9wKGVsZW1lbnRzKSB7XG4gICAgdmFyIHJkID0gQXRvbWljcy5sb2FkKHRoaXMucmVhZF9wdHIsIDApO1xuICAgIHZhciB3ciA9IEF0b21pY3MubG9hZCh0aGlzLndyaXRlX3B0ciwgMCk7XG5cbiAgICBpZiAod3IgPT0gcmQpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxldCB0b19yZWFkID0gTWF0aC5taW4odGhpcy5fYXZhaWxhYmxlX3JlYWQocmQsIHdyKSwgZWxlbWVudHMubGVuZ3RoKTtcblxuICAgIGxldCBmaXJzdF9wYXJ0ID0gTWF0aC5taW4odGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpIC0gcmQsIGVsZW1lbnRzLmxlbmd0aCk7XG4gICAgbGV0IHNlY29uZF9wYXJ0ID0gdG9fcmVhZCAtIGZpcnN0X3BhcnQ7XG5cbiAgICB0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSwgcmQsIGVsZW1lbnRzLCAwLCBmaXJzdF9wYXJ0KTtcbiAgICB0aGlzLl9jb3B5KHRoaXMuc3RvcmFnZSwgMCwgZWxlbWVudHMsIGZpcnN0X3BhcnQsIHNlY29uZF9wYXJ0KTtcblxuICAgIEF0b21pY3Muc3RvcmUodGhpcy5yZWFkX3B0ciwgMCwgKHJkICsgdG9fcmVhZCkgJSB0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkpO1xuXG4gICAgcmV0dXJuIHRvX3JlYWQ7XG4gIH1cblxuICAvLyBUcnVlIGlmIHRoZSByaW5nIGJ1ZmZlciBpcyBlbXB0eSBmYWxzZSBvdGhlcndpc2UuIFRoaXMgY2FuIGJlIGxhdGUgb24gdGhlXG4gIC8vIHJlYWRlciBzaWRlOiBpdCBjYW4gcmV0dXJuIHRydWUgZXZlbiBpZiBzb21ldGhpbmcgaGFzIGp1c3QgYmVlbiBwdXNoZWQuXG4gIGVtcHR5KCkge1xuICAgIHZhciByZCA9IEF0b21pY3MubG9hZCh0aGlzLnJlYWRfcHRyLCAwKTtcbiAgICB2YXIgd3IgPSBBdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsIDApO1xuXG4gICAgcmV0dXJuIHdyID09IHJkO1xuICB9XG5cbiAgLy8gVHJ1ZSBpZiB0aGUgcmluZyBidWZmZXIgaXMgZnVsbCwgZmFsc2Ugb3RoZXJ3aXNlLiBUaGlzIGNhbiBiZSBsYXRlIG9uIHRoZVxuICAvLyB3cml0ZSBzaWRlOiBpdCBjYW4gcmV0dXJuIHRydWUgd2hlbiBzb21ldGhpbmcgaGFzIGp1c3QgYmVlbiBwb3BlZC5cbiAgZnVsbCgpIHtcbiAgICB2YXIgcmQgPSBBdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwgMCk7XG4gICAgdmFyIHdyID0gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLCAwKTtcblxuICAgIHJldHVybiAod3IgKyAxKSAlIHRoaXMuY2FwYWNpdHkgIT0gcmQ7XG4gIH1cblxuICAvLyBUaGUgdXNhYmxlIGNhcGFjaXR5IGZvciB0aGUgcmluZyBidWZmZXI6IHRoZSBudW1iZXIgb2YgZWxlbWVudHMgdGhhdCBjYW4gYmVcbiAgLy8gc3RvcmVkLlxuICBjYXBhY2l0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5jYXBhY2l0eSAtIDE7XG4gIH1cblxuICAvLyBOdW1iZXIgb2YgZWxlbWVudHMgYXZhaWxhYmxlIGZvciByZWFkaW5nLiBUaGlzIGNhbiBiZSBsYXRlLCBhbmQgcmVwb3J0IGxlc3NcbiAgLy8gZWxlbWVudHMgdGhhdCBpcyBhY3R1YWxseSBpbiB0aGUgcXVldWUsIHdoZW4gc29tZXRoaW5nIGhhcyBqdXN0IGJlZW5cbiAgLy8gZW5xdWV1ZWQuXG4gIGF2YWlsYWJsZV9yZWFkKCkge1xuICAgIHZhciByZCA9IEF0b21pY3MubG9hZCh0aGlzLnJlYWRfcHRyLCAwKTtcbiAgICB2YXIgd3IgPSBBdG9taWNzLmxvYWQodGhpcy53cml0ZV9wdHIsIDApO1xuICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGVfcmVhZChyZCwgd3IpO1xuICB9XG5cbiAgLy8gTnVtYmVyIG9mIGVsZW1lbnRzIGF2YWlsYWJsZSBmb3Igd3JpdGluZy4gVGhpcyBjYW4gYmUgbGF0ZSwgYW5kIHJlcG9ydCBsZXNzXG4gIC8vIGVsZW10bnMgdGhhdCBpcyBhY3R1YWxseSBhdmFpbGFibGUgZm9yIHdyaXRpbmcsIHdoZW4gc29tZXRoaW5nIGhhcyBqdXN0XG4gIC8vIGJlZW4gZGVxdWV1ZWQuXG4gIGF2YWlsYWJsZV93cml0ZSgpIHtcbiAgICB2YXIgcmQgPSBBdG9taWNzLmxvYWQodGhpcy5yZWFkX3B0ciwgMCk7XG4gICAgdmFyIHdyID0gQXRvbWljcy5sb2FkKHRoaXMud3JpdGVfcHRyLCAwKTtcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlX3dyaXRlKHJkLCB3cik7XG4gIH1cblxuICAvLyBwcml2YXRlIG1ldGhvZHMgLy9cblxuICAvLyBOdW1iZXIgb2YgZWxlbWVudHMgYXZhaWxhYmxlIGZvciByZWFkaW5nLCBnaXZlbiBhIHJlYWQgYW5kIHdyaXRlIHBvaW50ZXIuLlxuICBfYXZhaWxhYmxlX3JlYWQocmQsIHdyKSB7XG4gICAgaWYgKHdyID4gcmQpIHtcbiAgICAgIHJldHVybiB3ciAtIHJkO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gd3IgKyB0aGlzLl9zdG9yYWdlX2NhcGFjaXR5KCkgLSByZDtcbiAgICB9XG4gIH1cblxuICAvLyBOdW1iZXIgb2YgZWxlbWVudHMgYXZhaWxhYmxlIGZyb20gd3JpdGluZywgZ2l2ZW4gYSByZWFkIGFuZCB3cml0ZSBwb2ludGVyLlxuICBfYXZhaWxhYmxlX3dyaXRlKHJkLCB3cikge1xuICAgIGxldCBydiA9IHJkIC0gd3IgLSAxO1xuICAgIGlmICh3ciA+PSByZCkge1xuICAgICAgcnYgKz0gdGhpcy5fc3RvcmFnZV9jYXBhY2l0eSgpO1xuICAgIH1cbiAgICByZXR1cm4gcnY7XG4gIH1cblxuICAvLyBUaGUgc2l6ZSBvZiB0aGUgc3RvcmFnZSBmb3IgZWxlbWVudHMgbm90IGFjY291bnRpbmcgdGhlIHNwYWNlIGZvciB0aGUgaW5kZXguXG4gIF9zdG9yYWdlX2NhcGFjaXR5KCkge1xuICAgIHJldHVybiB0aGlzLmNhcGFjaXR5O1xuICB9XG5cbiAgLy8gQ29weSBgc2l6ZWAgZWxlbWVudHMgZnJvbSBgaW5wdXRgLCBzdGFydGluZyBhdCBvZmZzZXQgYG9mZnNldF9pbnB1dGAsIHRvXG4gIC8vIGBvdXRwdXRgLCBzdGFydGluZyBhdCBvZmZzZXQgYG9mZnNldF9vdXRwdXRgLlxuICBfY29weShpbnB1dCwgb2Zmc2V0X2lucHV0LCBvdXRwdXQsIG9mZnNldF9vdXRwdXQsIHNpemUpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykge1xuICAgICAgb3V0cHV0W29mZnNldF9vdXRwdXQgKyBpXSA9IGlucHV0W29mZnNldF9pbnB1dCArIGldO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBBdWRpb1JlYWRlciwgQXVkaW9Xcml0ZXIsIFBhcmFtZXRlclJlYWRlciwgUGFyYW1ldGVyV3JpdGVyLCBSaW5nQnVmZmVyLCBkZWludGVybGVhdmUsIGludGVybGVhdmUgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzLmpzLm1hcFxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IFJpbmdCdWZmZXIgfSBmcm9tIFwicmluZ2J1Zi5qc1wiO1xuc2VsZi5SaW5nQnVmZmVyID0gUmluZ0J1ZmZlcjtcblxudmFyIG91dHB1dFNBQnMgPSB7fTtcbmNsYXNzIE1MU0FCT3V0cHV0VHJhbnNkdWNlciB7XG5cbiAgY29uc3RydWN0b3IoYnVmZmVyVHlwZSwgY2hhbm5lbCwgYmxvY2tzaXplKSB7XG4gICAgdGhpcy5jaGFubmVsID0gY2hhbm5lbDtcbiAgICB0aGlzLmJsb2Nrc2l6ZSA9IGJsb2Nrc2l6ZTtcbiAgICAgIC8vY2hlY2sgZm9yIGV4aXN0aW5nIGNoYW5uZWxzXG4gICAgaWYgKGNoYW5uZWwgaW4gb3V0cHV0U0FCcyAmJiBvdXRwdXRTQUJzW2NoYW5uZWxdLmJsb2Nrc2l6ZSA9PSBibG9ja3NpemUpIHtcbiAgICAgIC8vcmV1c2UgZXhpc3RpbmdcbiAgICAgIHRoaXMucmluZ2J1ZiA9IG91dHB1dFNBQnNbY2hhbm5lbF0ucmI7XG4gICAgfWVsc2V7XG4gICAgICAvL2NyZWF0ZSBhIG5ldyBTQUIgYW5kIG5vdGlmeSB0aGUgcmVjZWl2ZXJcbiAgICAgIHRoaXMuc2FiID0gUmluZ0J1ZmZlci5nZXRTdG9yYWdlRm9yQ2FwYWNpdHkoMzIgKiBibG9ja3NpemUsIEZsb2F0NjRBcnJheSk7XG4gICAgICB0aGlzLnJpbmdidWYgPSBuZXcgUmluZ0J1ZmZlcih0aGlzLnNhYiwgRmxvYXQ2NEFycmF5KTtcblxuICAgICAgb3V0cHV0U0FCc1tjaGFubmVsXSA9IHtcbiAgICAgICAgcmI6dGhpcy5yaW5nYnVmLFxuICAgICAgICBzYWI6dGhpcy5zYWIsXG4gICAgICAgIGNyZWF0ZWQ6RGF0ZS5ub3coKSxcbiAgICAgICAgYmxvY2tzaXplOmJsb2Nrc2l6ZSB9O1xuXG4gICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgIGZ1bmM6ICdzYWInLFxuICAgICAgICB2YWx1ZTogdGhpcy5zYWIsXG4gICAgICAgIHR0eXBlOiBidWZmZXJUeXBlLFxuICAgICAgICBjaGFubmVsSUQ6IGNoYW5uZWwsXG4gICAgICAgIGJsb2Nrc2l6ZTpibG9ja3NpemVcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNlbmQodmFsdWUpIHtcbiAgICBpZiAodGhpcy5yaW5nYnVmLmF2YWlsYWJsZV93cml0ZSgpID4gMSkge1xuICAgICAgaWYgKHR5cGVvZih2YWx1ZSkgPT0gXCJudW1iZXJcIikge1xuICAgICAgICB0aGlzLnJpbmdidWYucHVzaChuZXcgRmxvYXQ2NEFycmF5KFt2YWx1ZV0pKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09IHRoaXMuYmxvY2tzaXplKSB7XG4gICAgICAgICAgdGhpcy5yaW5nYnVmLnB1c2godmFsdWUpO1xuICAgICAgICB9ZWxzZSBpZiAodmFsdWUubGVuZ3RoIDwgdGhpcy5ibG9ja3NpemUpIHtcbiAgICAgICAgICBsZXQgbmV3VmFsID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLmJsb2Nrc2l6ZSk7XG4gICAgICAgICAgZm9yKGxldCBpIGluIHZhbHVlKSBuZXdWYWxbaV0gPSB2YWx1ZVtpXTtcbiAgICAgICAgICB0aGlzLnJpbmdidWYucHVzaChuZXdWYWwpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLnJpbmdidWYucHVzaCh2YWx1ZS5zbGljZSgwLHRoaXMuYmxvY2tzaXplKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuc2VsZi5jcmVhdGVPdXRwdXRDaGFubmVsID0gKCBpZCwgYmxvY2tzaXplICkgPT4ge1xuICByZXR1cm4gbmV3IE1MU0FCT3V0cHV0VHJhbnNkdWNlcignTUwnLCBpZCwgYmxvY2tzaXplKTtcbn07XG5cbnNlbGYuaW5wdXQgPSAoIHZhbHVlLCBjaGFubmVsICkgPT4ge31cblxuc2VsZi5vdXRwdXQgPSAoIHZhbHVlLCBjaGFubmVsICkgPT4geyBwb3N0TWVzc2FnZSggeyBmdW5jOidkYXRhJywgdmFsOnZhbHVlLCBjaDpjaGFubmVsIH0pOyB9XG5cbiAgZnVuY3Rpb24gZ2V2YWxBbGwoKSB7XG4gICAgaWYgKCFnZXZhbCkge1xuICAgICAgdmFyIGdldmFsID0gZXZhbDsgLy8gcHV0cyBldmFsIGludG8gZ2xvYmFsIHNjb3BlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL2V2YWxcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGdldmFsKGBcbiAgICAgICAgICB2YXIgbG9hZFJlc3BvbmRlcnMgPSB7fTtcbiAgICAgICAgICB2YXIgaW5wdXRTQUJzPXt9O1xuICAgICAgICAgIHZhciBzZW1hID0ge1xuICAgICAgICAgICAgc2F2ZUYzMkFycmF5OiAobmFtZSwgdmFsKSA9PiB7XG4gICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICBcImZ1bmNcIjogXCJzYXZlXCIsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IG5hbWUsXG4gICAgICAgICAgICAgICAgXCJ2YWxcIjogdmFsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2FkRjMyQXJyYXk6IChuYW1lLCBvbmxvYWQpID0+IHtcbiAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIFwiZnVuY1wiOiBcImxvYWRcIixcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogbmFtZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGxvYWRSZXNwb25kZXJzW25hbWVdID0gb25sb2FkO1xuICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkb3dubG9hZDogKG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIFwiZnVuY1wiOiBcImRvd25sb2FkXCIsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IG5hbWUsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmRDb2RlOiAoY29kZSkgPT4ge1xuICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgXCJmdW5jXCI6IFwic2VuZGNvZGVcIixcbiAgICAgICAgICAgICAgICBcImNvZGVcIjogY29kZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGJjb3B5OiAobXNnKSA9PiB7XG4gICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICBcImZ1bmNcIjogXCJwYmNvcHlcIixcbiAgICAgICAgICAgICAgICBcIm1zZ1wiOiBtc2csXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmRCdWZmZXI6IChidWZmZXJOYW1lLGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgIFwiZnVuY1wiOiBcInNlbmRidWZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGJ1ZmZlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBkYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW52OiB7XG4gICAgICAgICAgICAgIHNhdmVMb2NhbDogKG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgXCJmdW5jXCI6IFwiZW52c2F2ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgIFwic3RvcmFnZVwiOlwibG9jYWxcIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbG9hZExvY2FsOiAobmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICBcImZ1bmNcIjogXCJlbnZsb2FkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgXCJzdG9yYWdlXCI6XCJsb2NhbFwiXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzYXZlVG9QQjogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICBcImZ1bmNcIjogXCJlbnZzYXZlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgXCJzdG9yYWdlXCI6XCJwYXN0ZWJ1ZmZlclwiXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBsb2FkR2lzdDogKGdpc3RpZCkgPT4ge1xuICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICBcImZ1bmNcIjogXCJlbnZsb2FkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGdpc3RpZCxcbiAgICAgICAgICAgICAgICAgICAgICBcInN0b3JhZ2VcIjpcImdpc3RcIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vcnVuIGluIHRoZSBET01cbiAgICAgICAgICAgIGRvbWV2YWw6IChjb2RlKSA9PiB7XG4gICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgXCJmdW5jXCI6IFwiZG9tZXZhbFwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvZGVcIjogY29kZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwZWVyaW5mbzogKCkgPT4ge1xuICAgICAgICAgICAgICBwb3N0TWVzc2FnZSAoe1xuICAgICAgICAgICAgICAgIFwiZnVuY1wiOiBcInBlZXJpbmZvXCJcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiWW91ciBwZWVyIElEIGhhcyBiZWVuIGNvcGllZCB0byB0aGUgcGFzdGUgYnVmZmVyXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgIGApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVSUk9SOmV2YWw6XCIsIGVycik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5pdFdpdGhVUkwodXJsKXtcbiAgICBpZiggbmV3IFVSTCh1cmwpICl7XG4gICAgICB0cnkge1xuICAgICAgICBpbXBvcnRTY3JpcHRzKHVybCArIFwiL2xhbG9saWIuanNcIik7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVSUk9SOiBpbXBvcnRTY3JpcHRzIOKAkyBsYWxvbGliLmpzIFwiLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICB0cnl7XG4gICAgICAgIGltcG9ydFNjcmlwdHModXJsICsgXCIvc3ZkLmpzXCIpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFUlJPUjogaW1wb3J0U2NyaXB0cyDigJMgc3ZkLmpzIFwiLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICB0cnl7XG4gICAgICAgIGltcG9ydFNjcmlwdHMoXG4gICAgICAgICAgXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0B0ZW5zb3JmbG93L3RmanMvZGlzdC90Zi5taW4uanNcIlxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFUlJPUjogaW1wb3J0U2NyaXB0cyDigJMgdGZqc1wiLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICB0cnl7XG4gICAgICAgIGdldmFsQWxsKCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVSUk9SOiBnZXZhbEFsbFwiLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICB0cnl7XG4gICAgICAgIHNhYkNoZWNrZXIoKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRVJST1I6IHNhYkNoZWNrZXJcIiwgZXJyKTtcbiAgICAgIH1cblxuICAgICAgcG9zdE1lc3NhZ2UoeyBpbml0OiB0cnVlIH0pO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICBjb25zb2xlLmVycm9yKFwiRVJST1I6IGluaXRXaXRoVVJMIOKAkyBJbnZhbGlkIFVSTFwiKTtcbiAgfVxuXG5vbm1lc3NhZ2UgPSBtID0+IHtcbiAgLy8gY29uc29sZS5sb2coXCJERUJVRzp3b3JrZXI6b25tZXNzYWdlXCIpO1xuICAvLyBjb25zb2xlLmxvZyhtKTtcblxuICAvLyBJbml0IG1lc3NhZ2Ugb25seVxuICBpZihtLmRhdGEudXJsKXtcbiAgICBpbml0V2l0aFVSTChtLmRhdGEudXJsKTtcbiAgfVxuXG4gIGlmIChtLmRhdGEuZXZhbCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIWdldmFsKSB2YXIgZ2V2YWwgPSBldmFsO1xuICAgICAgbGV0IGV2YWxSZXMgPSBnZXZhbChtLmRhdGEuZXZhbCk7XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiREVCVUc6d29ya2VyOmdldmFsXCIpO1xuICAgICAgLy8gY29uc29sZS5sb2coZXZhbFJlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihgRVJST1I6d29ya2VyOmdldmFsIGV4Y2VwdGlvbjogJHtlfSBgLCBtLmRhdGEuZXZhbCk7XG4gICAgfVxuXG4gIH0gZWxzZSBpZiAoXCJ2YWxcIiBpbiBtLmRhdGEpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcIkRFQlVHOm1sLndvcmtlcjpvbm1lc3NhZ2U6dmFsXCIpO1xuICAgIGxldCB2YWwgPSBtLmRhdGEudmFsO1xuICAgIC8vIGNvbnNvbGUubG9nKHZhbCk7XG4gICAgdmFsID0gSlNPTi5wYXJzZShgWyR7dmFsfV1gKTtcbiAgICAvLyBjb25zb2xlLmxvZyh2YWwpO1xuICAgIC8vIGNvbnNvbGUubG9nKGxvYWRSZXNwb25kZXJzKTtcbiAgICBsb2FkUmVzcG9uZGVyc1ttLmRhdGEubmFtZV0odmFsKTtcbiAgICBkZWxldGUgbG9hZFJlc3BvbmRlcnNbbS5kYXRhLm5hbWVdO1xuXG4gIH0gZWxzZSBpZiAobS5kYXRhLnR5cGUgPT09IFwibW9kZWwtaW5wdXQtZGF0YVwiKSB7XG5cbiAgICBpbnB1dChtLmRhdGEudmFsdWUsIG0uZGF0YS5jaCk7XG5cbiAgLy8gfSBlbHNlIGlmIChtLmRhdGEudHlwZSA9PT0gXCJtb2RlbC1pbnB1dC1idWZmZXJcIikge1xuICB9IGVsc2UgaWYgKG0uZGF0YS5zYWIpe1xuXG4gICAgY29uc29sZS5sb2coXCJERUJVRzogU0FCIHJlY2VpdmVkXCIsIG0pO1xuXG4gICAgbGV0IHNhYiA9IG0uZGF0YS5zYWI7XG4gICAgbGV0IHJiID0gbmV3IFJpbmdCdWZmZXIoc2FiLCBGbG9hdDY0QXJyYXkpO1xuXG4gICAgaW5wdXRTQUJzW20uZGF0YS5jaGFubmVsSURdID0ge1xuICAgICAgc2FiLFxuICAgICAgcmIsXG4gICAgICBibG9ja3NpemU6IG0uZGF0YS5ibG9ja3NpemVcbiAgICB9O1xuXG4gICAgY29uc29sZS5sb2coXCJNTFwiLCBpbnB1dFNBQnMpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBzYWJDaGVja2VyKCkge1xuICB0cnkge1xuICAgIC8vIGNvbnNvbGUubG9nKGlucHV0U0FCcyk7XG4gICAgZm9yIChsZXQgdiBpbiBpbnB1dFNBQnMpIHtcbiAgICAgIGxldCBhdmFpbCA9IGlucHV0U0FCc1t2XS5yYi5hdmFpbGFibGVfcmVhZCgpO1xuICAgICAgLy8gY29uc29sZS5sb2coYXZhaWwsIGlucHV0U0FCc1t2XS5yYi5jYXBhY2l0eSwgaW5wdXRTQUJzW3ZdLmJsb2Nrc2l6ZSk7XG4gICAgICBpZiAoYXZhaWwgIT0gaW5wdXRTQUJzW3ZdLnJiLmNhcGFjaXR5ICYmIGF2YWlsID4gMCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF2YWlsOyBpICs9IGlucHV0U0FCc1t2XS5ibG9ja3NpemUpIHtcbiAgICAgICAgICBsZXQgdmFsID0gbmV3IEZsb2F0NjRBcnJheShpbnB1dFNBQnNbdl0uYmxvY2tzaXplKTtcbiAgICAgICAgICBpbnB1dFNBQnNbdl0ucmIucG9wKHZhbCk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2codmFsKTtcbiAgICAgICAgICBpbnB1dCh2LCB2YWwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHNldFRpbWVvdXQoc2FiQ2hlY2tlciwgMjApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICBzZXRUaW1lb3V0KHNhYkNoZWNrZXIsIDEwMCk7XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIlJpbmdCdWZmZXIiLCJbb2JqZWN0IE9iamVjdF0iLCJjYXBhY2l0eSIsInR5cGUiLCJCWVRFU19QRVJfRUxFTUVOVCIsImJ5dGVzIiwiU2hhcmVkQXJyYXlCdWZmZXIiLCJzYWIiLCJBcnJheUJ1ZmZlciIsIl9fcHJvdG9fXyIsImlzUHJvdG90eXBlT2YiLCJ1bmRlZmluZWQiLCJ0aGlzIiwiX3R5cGUiLCJieXRlTGVuZ3RoIiwiYnVmIiwid3JpdGVfcHRyIiwiVWludDMyQXJyYXkiLCJyZWFkX3B0ciIsInN0b3JhZ2UiLCJuYW1lIiwiZWxlbWVudHMiLCJyZCIsIkF0b21pY3MiLCJsb2FkIiwid3IiLCJfc3RvcmFnZV9jYXBhY2l0eSIsInRvX3dyaXRlIiwiTWF0aCIsIm1pbiIsIl9hdmFpbGFibGVfd3JpdGUiLCJsZW5ndGgiLCJmaXJzdF9wYXJ0Iiwic2Vjb25kX3BhcnQiLCJfY29weSIsInN0b3JlIiwidG9fcmVhZCIsIl9hdmFpbGFibGVfcmVhZCIsInJ2IiwiaW5wdXQiLCJvZmZzZXRfaW5wdXQiLCJvdXRwdXQiLCJvZmZzZXRfb3V0cHV0Iiwic2l6ZSIsImkiLCJzZWxmIiwib3V0cHV0U0FCcyIsIk1MU0FCT3V0cHV0VHJhbnNkdWNlciIsImJ1ZmZlclR5cGUiLCJjaGFubmVsIiwiYmxvY2tzaXplIiwicmluZ2J1ZiIsInJiIiwiZ2V0U3RvcmFnZUZvckNhcGFjaXR5IiwiRmxvYXQ2NEFycmF5IiwiY3JlYXRlZCIsIkRhdGUiLCJub3ciLCJwb3N0TWVzc2FnZSIsImZ1bmMiLCJ2YWx1ZSIsInR0eXBlIiwiY2hhbm5lbElEIiwiYXZhaWxhYmxlX3dyaXRlIiwicHVzaCIsIm5ld1ZhbCIsInNsaWNlIiwiaW5pdFdpdGhVUkwiLCJ1cmwiLCJVUkwiLCJpbXBvcnRTY3JpcHRzIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZ2V2YWwiLCJldmFsIiwiZ2V2YWxBbGwiLCJzYWJDaGVja2VyIiwiaW5pdCIsInYiLCJpbnB1dFNBQnMiLCJhdmFpbCIsImF2YWlsYWJsZV9yZWFkIiwidmFsIiwicG9wIiwic2V0VGltZW91dCIsImNyZWF0ZU91dHB1dENoYW5uZWwiLCJpZCIsImNoIiwib25tZXNzYWdlIiwibSIsImRhdGEiLCJlIiwiSlNPTiIsInBhcnNlIiwibG9hZFJlc3BvbmRlcnMiLCJsb2ciXSwibWFwcGluZ3MiOiJ5QkF5S0EsTUFBTUEsRUFDSkMsNkJBQTZCQyxFQUFVQyxHQUNyQyxJQUFLQSxFQUFLQyxrQkFDUixLQUFNLGlDQUVSLElBQUlDLEVBQVEsR0FBS0gsRUFBVyxHQUFLQyxFQUFLQyxrQkFDdEMsT0FBTyxJQUFJRSxrQkFBa0JELEdBSS9CSixZQUFZTSxFQUFLSixHQUNmLElBQUtLLFlBQVlDLFVBQVVDLGNBQWNQLFNBQ1pRLElBQTNCUixFQUFLQyxrQkFDTCxLQUFNLHVEQVFSUSxLQUFLQyxNQUFRVixFQUNiUyxLQUFLVixVQUFZSyxFQUFJTyxXQUFhLEdBQUtYLEVBQUtDLGtCQUM1Q1EsS0FBS0csSUFBTVIsRUFDWEssS0FBS0ksVUFBWSxJQUFJQyxZQUFZTCxLQUFLRyxJQUFLLEVBQUcsR0FDOUNILEtBQUtNLFNBQVcsSUFBSUQsWUFBWUwsS0FBS0csSUFBSyxFQUFHLEdBQzdDSCxLQUFLTyxRQUFVLElBQUloQixFQUFLUyxLQUFLRyxJQUFLLEVBQUdILEtBQUtWLFVBSTVDRCxPQUNFLE9BQU9XLEtBQUtDLE1BQU1PLEtBS3BCbkIsS0FBS29CLEdBQ0gsSUFBSUMsRUFBS0MsUUFBUUMsS0FBS1osS0FBS00sU0FBVSxHQUNqQ08sRUFBS0YsUUFBUUMsS0FBS1osS0FBS0ksVUFBVyxHQUV0QyxJQUFLUyxFQUFLLEdBQUtiLEtBQUtjLHFCQUF1QkosRUFFekMsT0FBTyxFQUdULElBQUlLLEVBQVdDLEtBQUtDLElBQUlqQixLQUFLa0IsaUJBQWlCUixFQUFJRyxHQUFLSixFQUFTVSxRQUM1REMsRUFBYUosS0FBS0MsSUFBSWpCLEtBQUtjLG9CQUFzQkQsRUFBSUUsR0FDckRNLEVBQWNOLEVBQVdLLEVBWTdCLE9BVkFwQixLQUFLc0IsTUFBTWIsRUFBVSxFQUFHVCxLQUFLTyxRQUFTTSxFQUFJTyxHQUMxQ3BCLEtBQUtzQixNQUFNYixFQUFVVyxFQUFZcEIsS0FBS08sUUFBUyxFQUFHYyxHQUdsRFYsUUFBUVksTUFDTnZCLEtBQUtJLFVBQ0wsR0FDQ1MsRUFBS0UsR0FBWWYsS0FBS2MscUJBR2xCQyxFQU1UMUIsSUFBSW9CLEdBQ0YsSUFBSUMsRUFBS0MsUUFBUUMsS0FBS1osS0FBS00sU0FBVSxHQUNqQ08sRUFBS0YsUUFBUUMsS0FBS1osS0FBS0ksVUFBVyxHQUV0QyxHQUFJUyxHQUFNSCxFQUNSLE9BQU8sRUFHVCxJQUFJYyxFQUFVUixLQUFLQyxJQUFJakIsS0FBS3lCLGdCQUFnQmYsRUFBSUcsR0FBS0osRUFBU1UsUUFFMURDLEVBQWFKLEtBQUtDLElBQUlqQixLQUFLYyxvQkFBc0JKLEVBQUlELEVBQVNVLFFBQzlERSxFQUFjRyxFQUFVSixFQU81QixPQUxBcEIsS0FBS3NCLE1BQU10QixLQUFLTyxRQUFTRyxFQUFJRCxFQUFVLEVBQUdXLEdBQzFDcEIsS0FBS3NCLE1BQU10QixLQUFLTyxRQUFTLEVBQUdFLEVBQVVXLEVBQVlDLEdBRWxEVixRQUFRWSxNQUFNdkIsS0FBS00sU0FBVSxHQUFJSSxFQUFLYyxHQUFXeEIsS0FBS2MscUJBRS9DVSxFQUtUbkMsUUFDRSxJQUFJcUIsRUFBS0MsUUFBUUMsS0FBS1osS0FBS00sU0FBVSxHQUdyQyxPQUZTSyxRQUFRQyxLQUFLWixLQUFLSSxVQUFXLElBRXpCTSxFQUtmckIsT0FDRSxJQUFJcUIsRUFBS0MsUUFBUUMsS0FBS1osS0FBS00sU0FBVSxHQUdyQyxPQUZTSyxRQUFRQyxLQUFLWixLQUFLSSxVQUFXLEdBRXpCLEdBQUtKLEtBQUtWLFVBQVlvQixFQUtyQ3JCLFdBQ0UsT0FBT1csS0FBS1YsU0FBVyxFQU16QkQsaUJBQ0UsSUFBSXFCLEVBQUtDLFFBQVFDLEtBQUtaLEtBQUtNLFNBQVUsR0FDakNPLEVBQUtGLFFBQVFDLEtBQUtaLEtBQUtJLFVBQVcsR0FDdEMsT0FBT0osS0FBS3lCLGdCQUFnQmYsRUFBSUcsR0FNbEN4QixrQkFDRSxJQUFJcUIsRUFBS0MsUUFBUUMsS0FBS1osS0FBS00sU0FBVSxHQUNqQ08sRUFBS0YsUUFBUUMsS0FBS1osS0FBS0ksVUFBVyxHQUN0QyxPQUFPSixLQUFLa0IsaUJBQWlCUixFQUFJRyxHQU1uQ3hCLGdCQUFnQnFCLEVBQUlHLEdBQ2xCLE9BQUlBLEVBQUtILEVBQ0FHLEVBQUtILEVBRUxHLEVBQUtiLEtBQUtjLG9CQUFzQkosRUFLM0NyQixpQkFBaUJxQixFQUFJRyxHQUNuQixJQUFJYSxFQUFLaEIsRUFBS0csRUFBSyxFQUluQixPQUhJQSxHQUFNSCxJQUNSZ0IsR0FBTTFCLEtBQUtjLHFCQUVOWSxFQUlUckMsb0JBQ0UsT0FBT1csS0FBS1YsU0FLZEQsTUFBTXNDLEVBQU9DLEVBQWNDLEVBQVFDLEVBQWVDLEdBQ2hELElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJRCxFQUFNQyxJQUN4QkgsRUFBT0MsRUFBZ0JFLEdBQUtMLEVBQU1DLEVBQWVJLElDblV2REMsS0FBSzdDLFdBQWFBLEVBRWxCLElBQUk4QyxFQUFhLEdBQ2pCLE1BQU1DLEVBRUo5QyxZQUFZK0MsRUFBWUMsRUFBU0MsR0FDL0J0QyxLQUFLcUMsUUFBVUEsRUFDZnJDLEtBQUtzQyxVQUFZQSxFQUViRCxLQUFXSCxHQUFjQSxFQUFXRyxHQUFTQyxXQUFhQSxFQUU1RHRDLEtBQUt1QyxRQUFVTCxFQUFXRyxHQUFTRyxJQUduQ3hDLEtBQUtMLElBQU1QLEVBQVdxRCxzQkFBc0IsR0FBS0gsRUFBV0ksY0FDNUQxQyxLQUFLdUMsUUFBVSxJQUFJbkQsRUFBV1ksS0FBS0wsSUFBSytDLGNBRXhDUixFQUFXRyxHQUFXLENBQ3BCRyxHQUFHeEMsS0FBS3VDLFFBQ1I1QyxJQUFJSyxLQUFLTCxJQUNUZ0QsUUFBUUMsS0FBS0MsTUFDYlAsVUFBVUEsR0FFWlEsWUFBWSxDQUNWQyxLQUFNLE1BQ05DLE1BQU9oRCxLQUFLTCxJQUNac0QsTUFBT2IsRUFDUGMsVUFBV2IsRUFDWEMsVUFBVUEsS0FLaEJqRCxLQUFLMkQsR0FDSCxHQUFJaEQsS0FBS3VDLFFBQVFZLGtCQUFvQixFQUNuQyxHQUFxQixtQkFDbkJuRCxLQUFLdUMsUUFBUWEsS0FBSyxJQUFJVixhQUFhLENBQUNNLFVBRXBDLEdBQUlBLEVBQU03QixRQUFVbkIsS0FBS3NDLFVBQ3ZCdEMsS0FBS3VDLFFBQVFhLEtBQUtKLFFBQ2QsR0FBSUEsRUFBTTdCLE9BQVNuQixLQUFLc0MsVUFBVyxDQUN2QyxJQUFJZSxFQUFTLElBQUlYLGFBQWExQyxLQUFLc0MsV0FDbkMsSUFBSSxJQUFJTixLQUFLZ0IsRUFBT0ssRUFBT3JCLEdBQUtnQixFQUFNaEIsR0FDdENoQyxLQUFLdUMsUUFBUWEsS0FBS0MsUUFFbEJyRCxLQUFLdUMsUUFBUWEsS0FBS0osRUFBTU0sTUFBTSxFQUFFdEQsS0FBS3NDLGFBd0g3QyxTQUFTaUIsRUFBWUMsR0FDbkIsR0FBSSxJQUFJQyxJQUFJRCxHQUFNLENBQ2hCLElBQ0VFLGNBQWNGLEVBQU0sZUFDcEIsTUFBT0csR0FDUEMsUUFBUUMsTUFBTSxxQ0FBc0NGLEdBR3RELElBQ0VELGNBQWNGLEVBQU0sV0FDcEIsTUFBT0csR0FDUEMsUUFBUUMsTUFBTSxpQ0FBa0NGLEdBR2xELElBQ0VELGNBQ0UsZ0VBRUYsTUFBT0MsR0FDUEMsUUFBUUMsTUFBTSw4QkFBK0JGLEdBRy9DLEtBL0hKLFdBQ0UsSUFBS0csRUFDSCxJQUFJQSxFQUFRQyxLQUVkLElBQ0VELEVBQU0sNnFGQStGTixNQUFPSCxHQUNQQyxRQUFRQyxNQUFNLGNBQWVGLElBMkIzQkssR0FDQSxNQUFPTCxHQUNQQyxRQUFRQyxNQUFNLGtCQUFtQkYsR0FHbkMsSUFDRU0sSUFDQSxNQUFPTixHQUNQQyxRQUFRQyxNQUFNLG9CQUFxQkYsR0FHckNiLFlBQVksQ0FBRW9CLE1BQU0sU0FHcEJOLFFBQVFDLE1BQU0sb0NBdURwQixTQUFTSSxJQUNQLElBRUUsSUFBSyxJQUFJRSxLQUFLQyxVQUFXLENBQ3ZCLElBQUlDLEVBQVFELFVBQVVELEdBQUczQixHQUFHOEIsaUJBRTVCLEdBQUlELEdBQVNELFVBQVVELEdBQUczQixHQUFHbEQsVUFBWStFLEVBQVEsRUFDL0MsSUFBSyxJQUFJckMsRUFBSSxFQUFHQSxFQUFJcUMsRUFBT3JDLEdBQUtvQyxVQUFVRCxHQUFHN0IsVUFBVyxDQUN0RCxJQUFJaUMsRUFBTSxJQUFJN0IsYUFBYTBCLFVBQVVELEdBQUc3QixXQUN4QzhCLFVBQVVELEdBQUczQixHQUFHZ0MsSUFBSUQsR0FFcEI1QyxNQUFNd0MsRUFBR0ksSUFJZkUsV0FBV1IsRUFBWSxJQUN2QixNQUFPSixHQUVQWSxXQUFXUixFQUFZLE1BL04zQmhDLEtBQUt5QyxvQkFBc0IsQ0FBRUMsRUFBSXJDLElBQ3hCLElBQUlILEVBQXNCLEtBQU13QyxFQUFJckMsR0FHN0NMLEtBQUtOLE1BQVEsQ0FBRXFCLEVBQU9YLE9BRXRCSixLQUFLSixPQUFTLENBQUVtQixFQUFPWCxLQUFlUyxZQUFhLENBQUVDLEtBQUssT0FBUXdCLElBQUl2QixFQUFPNEIsR0FBR3ZDLEtBbUpoRndDLFVBQVlDLElBU1YsR0FKR0EsRUFBRUMsS0FBS3ZCLEtBQ1JELEVBQVl1QixFQUFFQyxLQUFLdkIsS0FHakJzQixFQUFFQyxLQUFLaEIsS0FDVCxJQUNFLElBQUtELEVBQU8sSUFBSUEsRUFBUUMsS0FDVkQsRUFBTWdCLEVBQUVDLEtBQUtoQixNQUkzQixNQUFPaUIsR0FDUHBCLFFBQVFDLE1BQU0saUNBQWlDbUIsS0FBTUYsRUFBRUMsS0FBS2hCLFdBR3pELEdBQUksUUFBU2UsRUFBRUMsS0FBTSxDQUUxQixJQUFJUixFQUFNTyxFQUFFQyxLQUFLUixJQUVqQkEsRUFBTVUsS0FBS0MsTUFBTSxJQUFJWCxNQUdyQlksZUFBZUwsRUFBRUMsS0FBS3ZFLE1BQU0rRCxVQUNyQlksZUFBZUwsRUFBRUMsS0FBS3ZFLFdBRXhCLEdBQW9CLHFCQUFoQnNFLEVBQUVDLEtBQUt4RixLQUVoQm9DLE1BQU1tRCxFQUFFQyxLQUFLL0IsTUFBTzhCLEVBQUVDLEtBQUtILFNBR3RCLEdBQUlFLEVBQUVDLEtBQUtwRixJQUFJLENBRXBCaUUsUUFBUXdCLElBQUksc0JBQXVCTixHQUVuQyxJQUFJbkYsRUFBTW1GLEVBQUVDLEtBQUtwRixJQUNiNkMsRUFBSyxJQUFJcEQsRUFBV08sRUFBSytDLGNBRTdCMEIsVUFBVVUsRUFBRUMsS0FBSzdCLFdBQWEsQ0FDNUJ2RCxJQUFBQSxFQUNBNkMsR0FBQUEsRUFDQUYsVUFBV3dDLEVBQUVDLEtBQUt6QyxXQUdwQnNCLFFBQVF3QixJQUFJLEtBQU1oQiJ9",!1);class Learner{constructor(){this.dispatcher=new Dispatcher}addEventListener(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error adding event listener to Learner");this.dispatcher.addEventListener(e,t)}removeEventListner(e,t){if(!(this.dispatcher&&e&&t))throw new Error("Error removing event listener to Learner");this.dispatcher.removeEventListener(e,t)}async init(e){return this.worker=new WorkerFactory,new Promise(((t,o)=>{let i={};this.worker&&new URL(e)&&(this.worker.postMessage({url:e}),this.worker.onerror=this.onErrorHandler,this.worker.onmessage=e=>{i=e.data.init,console.info("running Learner"),t(i),this.worker.onmessage=this.onMessageHandler})}))}onMessageHandler=e=>{this.dispatcher.dispatch("onSharedBuffer",e.data),console.log("onSharedBuffer"),console.log(e)};onErrorHandler=e=>{console.log("onError"),console.log(e)};eval(e){this.worker&&e&&this.worker.postMessage({eval:e})}createSharedBuffer(e){if(!this.worker||!e.sab)throw new Error("Error creating shared buffer in Learner");this.worker.postMessage({sab:e.sab,blocksize:e.blocksize,channelID:e.channelID})}evalBlock(e){let t=e.indexOf("\n");"//--DOM"==e.substr(0,t)?(e=e.substr(t),evalDomCode(e),addToHistory("dom-history-",e)):(this.worker.postMessage({eval:e}),window.localStorage.setItem("modelEditorValue",codeMirror.getValue()),addToHistory("model-history-",e))}terminate(){this.worker.terminate(),this.worker=null}}function getBlock(e){if(e){let t=e.getCursor(),o=t.line,i=e.lastLine();for(;o<i;){if(/___+/.test(e.getLine(o))){i=o-1;break}o++}o=t.line;let l=-1;for(;o>=0;){if(/___+/.test(e.getLine(o))){l=o;break}o--}return l>-1&&l++,e.getRange({line:l,ch:0},{line:i+1,ch:0})}}var mooo=moo.mooo,nearley$1=nearley.nearley,semaa=sema.semaa;export{IR as ASTreeToJavascript,Engine,Learner,compile,compileGrammar,getBlock,getParserModuleExports,mooo,nearley$1 as nearley,semaa};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ^
2: //# sourceMappingURL=sema-engine.mjs.map
